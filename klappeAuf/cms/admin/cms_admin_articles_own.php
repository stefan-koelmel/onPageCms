<?php // charset:UTF-8class cmsAdmin_articles extends cmsAdmin_articles_base {    function checkList($dataList,$action) {                if ($_SESSION[userLevel] < 9) return 0;        return 0;        $action = "checkUrl";         echo ("CheckList $action <br />");                        switch ($action) {            case "checkUrl" :                $query = "SELECT `id`,`url`,`ticketUrl`,`name`,`location` FROM `klappeAuf_cms_articles` WHERE (`url` != '' OR `ticketUrl` != '') AND `dateRange` >='2012-08'";                                $result = mysql_query($query);                if (!$result) {                    echo ("$query<br>");                    return 0;                }                while ($article = mysql_fetch_assoc($result)) {                    $id   = $article[id];                    $name = $article[name];                    $url  = $article[url];                    $ticketUrl = $article[ticketUrl];                    $location = $article[location];                    $change = 0;                    $show = 0;                                        if ($url ) {                        $change = 0;                                                                                                echo ("$id Location =$location url = '$url'  <br>");                        $url = "";                        // $show = 1;                    }                                           if ($ticketUrl) {                        // $change = 1;                        //echo ("$id $name ticketUrl = '$ticketUrl'  <br>");                        // $ticketUrl = "";                        // $show = 1;                    }                                           if ($show) {                        echo ("$id $name '$url' '$ticketUrl' <br>");                    }                                        if ($change) {                        $query = "UPDATE `klappeAuf_cms_articles` SET `url` = '$url', `ticketUrl`='$ticketUrl' WHERE `id`=$id ";                        // $updateResult = mysql_query($query);                        if (!$updateResult) echo ("Error in Query: $query <br />");                    }                                                            }                                                break;                                        case "linkedDates" :                echo ("checkList $action <br>");                $query = "SELECT `id`,`link`,`name` FROM `klappeAuf_cms_articles` WHERE `link` != ''";               //  $query = "SELECT * FORM `klappeAuf_cms_articles` WHERE `link` != ''";                // $query = "SELECT `id` , `name` , `link` FROM `klappeAuf_cms_articles` WHERE 1 AND `link` != '\'\'' LIMIT 0 , 30";                $result = mysql_query($query);                if (!$result) echo ("$query<br>");                else {                    while ($article = mysql_fetch_assoc($result)) {                        $link = $article[link];                        $id   = $article[id];                        if ($link) {                            $dateId = substr($link,5);                            if (intval($dateId)) {                                $dateData = cmsDates_getById($dateId);                                // echo ("$article[id] $article[name] $article[link] $dateId <br>");                                $dateLink = $dateData[link];                                                                                                                                // echo (" -> Date DATA link = $dateLink <br>");                                $linkList = explode("|",$dateLink);                                                                $newLink = "article:$id";                                for ($i=0;$i<count($linkList);$i++) {                                    list($linkType,$linkIds) = explode(":",$linkList[$i]);                                    switch ($linkType) {                                        case "article" :                                            if ($linkIds != $id) {                                                // echo "ander Link Id articleId=$id TerminArtikelId =$linkIds<br>";                                            } else {                                                // echo ("LINK ID stimmt <br>");                                            }                                            break;                                        case "date" :                                            $newLink .= "|date:$linkIds";                                            break;                                    }                                                                        // echo (" -> $linkType = $linkIds <br>");                                                                    }                                if ($newLink != $dateLink) {                                    echo ("$article[id] $article[name] $article[link] $dateId <br>");                                    echo ("ANDERE LINK FOR DATE = $dateId <br>");                                    echo ("Link was = '$dateLink' <br>");                                    echo ("new '$newLink' <br>");                                                                        $query = "UPDATE `klappeAuf_cms_dates` SET `link`='$newLink' WHERE `id`=$dateId";                                    $resultUpdate = mysql_query($query);                                    if (!$resultUpdate) echo ("Error in $query <br>");                                    echo ("&nbsp;<br>");                                }                            }                        }                    }                }                                    break;            default :                echo ("unkown $action in Articles CheckList <br>");        }    }        function emptyListSelect_own() {        $ownSelect = array();        $ownSelect[specialView] = "active";        // $ownSelect["dateRange"] = "2012-06"; // month / nextMonth / week /nextWeek        //$ownSelect["specialView"] = "hidden";        //$ownSelect["region"] = 181;        //$ownSelect["category"] = 3;        return $ownSelect;    }        function emptyListFilter_own() {        $ownFilter = array();                return $ownFilter;    }              function emptyData() {        $saveData = array();        $saveData[highlight] = 3;        $saveData[show] = 1;        list($year,$month,$day) = explode("-", date("Y-m-d"));               $today = mktime(12,0,0,$month,$day,$year);        $startDay = $today+1*24*60*60;        // echo ("StartDay = ".date("Y-m-d")." -> ".date("Y-m-d",$startDay)." <br>");               $startDay = date("Y-m-d",$startDay);          $plusMonth = $month + 1;        $plusYear = $year;        if ($plusMonth>12) {            $plusMonth = 1;            $plusYear++;        }                if ($month<10) $month = "0".$month;        else $month = "".$month;        $monthStr = $year."-".$month;                if ($plusMonth<10) $plusMonth = "0".$plusMonth;        else $plusMonth = "".$plusMonth;        $plusMonthStr = $plusYear."-".$plusMonth;                        $saveData[dateRange] = $monthStr;        $saveData[fromDate] = $startDay; // $monthStr."-  ";        $saveData[toDate] = $plusMonthStr."-  ";//        $saveData[time] = "  :00";        return $saveData;    }     function location_showList() {        $showList = array();        $showList["image"] = array("name"=>"Artikelbild","width"=>80,"height"=>60,"sort"=>0);        $showList["fromDate"] = array("name"=>"Von","width"=>60);        $showList["toDate"] = array("name"=>"Bis","width"=>60);        $showList["name"] = array("name"=>"Name","width"=>180);        $showList["category"] = array("name"=>"Rubrik","width"=>130,"align"=>"left");        $showList["location"] = array("name"=>"Ort","width"=>130,"align"=>"left");        $showList["show"] = array("name"=>"Zeigen","width"=>50,"align"=>"center","sort"=>0);        $showList["highlight"] = array("name"=>"Sort","width"=>50,"align"=>"center","sort"=>1);        return $showList;    }    function admin_get_specialFilterList_own() {        $specialList = array();        $specialList[hidden] = array("id"=>"hidden","name"=>"Unsichtbare Artikel");        $specialList[hidden][filter] = array("show"=>0);        $specialList[hidden][sort] = "fromDate";        $specialList[active] = array("id"=>"active","name"=>"Aktive Artikel");        $specialList[active][filter] = array("show"=>1,"fromDate"=>"<='".date("Y-m-d")."'","toDate"=>">='".date("Y-m-d")."'");        $specialList[active][sort] = "fromDate";        $specialList[comeing] = array("id"=>"coming","name"=>"Kommende Artikel");        $specialList[comeing][filter] = array("show"=>1,"fromDate"=>">='".date("Y-m-d")."'");        $specialList[comeing][sort] = "fromDate";                $specialList[startpage] = array("id"=>"startpage","name"=>"Startseite");        $specialList[startpage][filter] = array("show"=>1,"new"=>1);        $specialList[startpage][sort] = "fromDate";                        $specialList[preview] = array("id"=>"preview","name"=>"Vorschau");        $specialList[preview][filter] = array("show"=>1,"fromDate"=>">='".date("Y-m-d")."'","highlight"=>">=4");        $specialList[preview][sort] = "fromDate";        $specialList[gone] = array("id"=>"gone","name"=>"Vergangen Artikel");        $specialList[gone][filter] = array("show"=>1,"toDate"=>"<='".date("Y-m-d")."'");        $specialList[gone][sort] = "toDate";        $specialList[noImage] = array("id"=>"noImage","name"=>"Ohne Bild");        $specialList[noImage][filter] = array("show"=>"-","image"=>"");        $specialList[noImage][sort] = "dateRange";        $specialList[noLocation] = array("id"=>"noLocation","name"=>"Ohne Ort");        $specialList[noLocation][filter] = array("show"=>"-","location"=>0);        $specialList[noLocation][sort] = "dateRange";        $specialList[oldCategory] = array("id"=>"noLocation","name"=>"Alte Kategorien");        $specialList[oldCategory][filter] = array("subCategory"=>"0");        $specialList[oldCategory][sort] = "category";        return $specialList;    }    function admin_get_filterList_own() {        $filterList = array();        $filterList[specialView]   = array();        $filterList[specialView]["name"] = "Spezielle Ansichten";        $filterList[specialView]["type"] = "specialView";        $filterList[specialView]["showData"] = array("submit"=>1,"empty"=>"normale Ansicht");        //$filterList[specialView]["filter"] = array("mainCat"=>180,"show"=>1);        // $filterList[specialView]["sort"] = "name";        $filterList[specialView]["dataName"] = "specialView";        $filterList[specialView][customFilter] = 1;        $filterList[dateRange]   = array();        $filterList[dateRange]["name"] = "Ausgabe";        $filterList[dateRange]["type"] = "category";        $filterList[dateRange]["showData"] = array("submit"=>1,"empty"=>"Alle Ausgaben","out"=>"info","idValue"=>"name");        $filterList[dateRange]["filter"] = array("mainCat"=>140,"show"=>1);        $filterList[dateRange]["sort"] = "name_up";        $filterList[dateRange]["dataName"] = "dateRange";        $filterList[dateRange][customFilter] = 1;        $filterList[produkt] = 0;        $filterList[category] = array();        $filterList[category]["name"] = "Kategorie";        $filterList[category]["type"] = "category";        $filterList[category]["dataName"] = "category";        $filterList[category]["showData"] = array("submit"=>1,"empty"=>"Alle Kategorien zeigen","notIds"=>array(328=>1));        $filterList[category]["filter"] = array("mainCat"=>144,"show"=>1);        $filterList[category]["sort"] = "name";        $filterList[category][customFilter] = 1;        $filterList[location] = array();        $filterList[location]["name"] = "Ort";        $filterList[location]["type"] = "location";        $filterList[location]["dataName"] = "location";        $filterList[location]["showData"] = array("submit"=>1,"type"=>"autoComplete","empty"=>"Ort wählen");        $filterList[location]["filter"] = array(); // "show"=>"1");        $filterList[location]["sort"] = "name";        $filterList[location][customFilter] = 1;        $filterList[content] = array();        $filterList[content]["name"] = "Inhalt";        $filterList[content]["type"] = "text";        $filterList[content]["dataName"] = "content";        $filterList[content]["showData"] = array("submit"=>1,"type"=>"text",);        $filterList[content]["sort"] = "name";        $filterList[content][customFilter] = 1;        return $filterList;    }       function edit_show_own($tableName,$specialData) {        $formatStr = "Formatierung: <br><b>Fett</b> = #f# Fett #f#<br><i>Kursiv</i> = #k# kursiv #k#";        $formatStr .= "<br>&sbquo;einfache Anführungszeichen&lsquo; => #a# Text #a#";        $formatStr .= "<br>&bdquo;doppelte Anführungszeichen&ldquo; => #A# Text #A#";                                $editShow = array();        $editShow[id]      = array("name"=>"Artikel Id","show"=>1,"showLevel"=>9,"type"=>"text","width"=>"small");        $editShow[id][readonly] = 1;        $editShow[id][needed] = 0;        $editShow[name]    = array("id"=>"firstFocus","name"=>"Überschrift","show"=>1,"type"=>"text","width"=>"standard");        $editShow[name][needed] = "textContent";        $editShow[name][needError] = "Kein Artikelname eingeben";        $editShow[subName]    = array("name"=>"2. Überschrift","show"=>1,"type"=>"text","width"=>"standard");        $editShow[toDate]    = array("name"=>"Zeigen bis Datum","show"=>1,"type"=>"date","mode"=>"simple","width"=>"100");        $editShow[toDate][nextDelimiter] = "bis";        $editShow[toDate][needed] = "date";        $editShow[toDate][needError] = "Kein Gültiges Bis-Datum eingegeben";        //$editShow[toDate][tip] = "Artikel deren Start-Datum nach dem heutigen Datum haben, werden als Vorschau auf der Webseite angezeigt.";        $editShow[toDate][next] = "fromDate";                $editShow[fromDate] = array("name"=>"von Datum","show"=>1,"type"=>"date","mode"=>"simple","width"=>"100");        $editShow[fromDate][needed] = "date";        $editShow[fromDate][nextDelimiter] = "zeigen ab";        $editShow[fromDate][needError] = "Kein Gültiges Start-Datum eingegeben";        $editShow[fromDate][tip] = "Artikel deren Start-Datum nach dem heutigen Datum haben, werden als Vorschau auf der Webseite angezeigt.";                // $editShow[fromDate][next] = "toDate";        //        $editShow[toDate]    = array("name"=>"bis Datum","show"=>1,"type"=>"date","mode"=>"simple","width"=>"100");//        $editShow[toDate][nextDelimiter] = "bis";//        $editShow[toDate][needed] = "date";//        $editShow[toDate][needError] = "Kein Gültiges Bis-Datum eingegeben";//        $editShow[toDate][tip] = "Artikel deren Start-Datum nach dem heutigen Datum haben, werden als Vorschau auf der Webseite angezeigt.";        $editShow[dateRange] = array("name"=>"Ausgabe","show"=>1,"type"=>"dropdown","dataSource"=>"category","width"=>"standard");        $editShow[dateRange][showData] = array("class"=>"adminArticles_DateRange","count"=>5,"mode"=>"single","out"=>"info","empty"=>"Ausgabe wählen","idValue"=>"name");        $editShow[dateRange][showFilter] = array("mainCat"=>140,"show"=>1);        $editShow[dateRange][showSort] = "id_up";        $editShow[dateRange][needed] = 1;        $editShow[dateRange][needError] = "Keine Ausgabe ausgewählt";        $editShow[dateRange][tip] = "Definiert die Ausgabe für das Archiv";                $editShow[info]    = array("name"=>"Text","show"=>1,"type"=>"textarea","width"=>"standard","height"=>"double");        $editShow[info][needed] = 0;        $editShow[info][tip] = $formatStr;        // Category        $editShow[category] = array("name"=>"Rubrik","show"=>1,"type"=>"toggle","width"=>"standard");        $editShow[category][showData] = array("class"=>"adminArticles_Category","count"=>3,"mode"=>"single");        $editShow[category][showData][dontShow] = array(328=>1);        $editShow[category][showFilter] = array("mainCat"=>144,"show"=>1);        $editShow[category][showSort] = "name";        $editShow[category][needed] = 1;        $editShow[category][needError] = "Keine Rubrik ausgewählt";        // Category        $editShow[subCategory] = array("name"=>"Unter-Rubrik","show"=>1,"type"=>"toggle","width"=>"standard");        $editShow[subCategory][dataSource] = "category";        $editShow[subCategory][showData] = array("class"=>"adminArticles_subCategory","count"=>3,"mode"=>"single");        $editShow[subCategory][showData][url] = "/cms_$GLOBALS[cmsVersion]/getData/category.php?cmsName=$GLOBALS[cmsName]&cmsVersion=$GLOBALS[cmsVersion]&type=toggle&mode=simple";        $editShow[subCategory][showFilter] = array("mainCat"=>$specialData[category],"show"=>1);        $editShow[subCategory][showSort] = "name";        $editShow[subCategory][needed] = 1 ;        $editShow[subCategory][needError] = "Keine Unter-Rubrik ausgewählt";        // Auto Complete        $editShow[location] = array("name"=>"Veranstaltungs-Ort","show"=>1,"type"=>"autoComplete","width"=>"standard");        $editShow[location][showData] = array("class"=>"adminArticles_Location","style"=>"width:".$width."px;","content"=>$specialData[locationName]);        $editShow[location][showFilter] = array("mainCat">0,"show"=>1);        $editShow[location][showSort] = "name";        $editShow[location][tip] = "Wählt den Veranstaltungsort aus der Datenbank";         // Region        $editShow[region] = array("name"=>"Region","show"=>0,"type"=>"toggle","width"=>"standard");        $editShow[region][showData] = array("class"=>"adminArticles_Region","count"=>5,"mode"=>"single");        $editShow[region][showFilter] = array("mainCat"=>180,"show"=>1);        $editShow[region][showSort] = "name";        $editShow[region][needed] = 0;        $editShow[region][needError] = "Keine Region ausgewählt";        $editShow[image] = array("name"=>"Artikel-Bild","show"=>1,"type"=>"imageSelectList","width"=>"standard","height"=>80);        $editShow[image][imageUpload] = 1;        $editShow[image][imageFolder] = "/articles/";        $editShow[image][needed] = 0;        $editShow[image][tip] = "Auflösung maximal 1000x1000 Pixel<br>Keine Umlaute oder Sonderzeichen<br>";                $editShow[url]    = array("name"=>"Zusätzliche Webseite","show"=>1,"type"=>"text","width"=>"standard","class"=>"adminArticles_url");        $editShow[url][showData] = array("class"=>"adminArticles_url");        $editShow[url][needed] = 0;        $editShow[url][tip] = "Zusätzliche Webseite zu dem Artikel";                $editShow[ticketUrl] = array("name"=>"Zusätzliche Webseiten","show"=>1,"type"=>"text","width"=>"standard","class"=>"adminArticles_ticketUrl");        $editShow[ticketUrl][showData] = array("class"=>"adminArticles_ticketUrl");        $editShow[ticketUrl][needed] = 0;        $editShow[ticketUrl][tip] = "Die Bezeichnung des Links kann man hinter die URL getrennt durch ein '#' scheiben.<br>Mehrere Links kann mann durch ein '*' trennen.<br>Beispiel:test.de#Gehe zu Test.de'123.de#mehr Infos";                $editShow[sort] = array("name"=>"Sortierung","show"=>0,"type"=>"text","width"=>"standard");        $editShow[sort][needed] = 0;                        $editShow[data] = array("name"=>"Data","show"=>0,"type"=>"text","width"=>"standard");        $editShow[data][needed] = 0;        $editShow[show] = array("name"=>"Anzeigen","show"=>1,"type"=>"checkbox","width"=>"standard");        $editShow[show][needed] = 0;        $editShow[show][tip] = "Artikel sichtbar";        $editShow["new"] = array("name"=>"Startseite","show"=>1,"type"=>"checkbox","width"=>"standard");        $editShow["new"][tip] = "Artikel werden auf der Startseite angezeigt wenn Startseite aktiviert ist und die Priorität 'hoch' oder 'ganz hoch' ist.";        $editShow["new"][tip] .= "<br /><b>Hierfür muss aber ein Bild vorhanden sein!</b>";                $editShow[highlight] = array("name"=>"Priorität","show"=>1,"type"=>"toggle","width"=>"standard");        $editShow[highlight][dataSource] = array("0"=>"ganz niedrig","1"=>"niedrig","2"=>"mittel","3"=>"standard","4"=>"hoch","5"=>"ganz hoch");        $editShow[highlight][showData] = array("count"=>6,"mode"=>"single","class"=>"highlightSelect");        $editShow[highlight][tip] = "Definiert die Reihenfolge der Artikel im Bereich der Rubriken";        $editShow[highlight][tip] .= "<br />Bei Priorität 'hoch' erscheint der Artikel wenn Startseite aktiviert ist in den Themenboxen auf der Startseite";        $editShow[highlight][tip] .= "<br />Bei Priorität 'ganz hoch' erscheint der Artikel wenn Startseite aktiviert auch in der Fläche neben den Tagestipps auf der Startseite";                                $editShow[link] = array("name"=>"Verknüpfungen","show"=>1,"type"=>"data","width"=>"standard");        $editShow[link][showData] = array();//        $editShow[link][showData][article] = array("name"=>"Artikel-Verknbüpfung","show"=>1,"type"=>"special","width"=>"standard");        $editShow[link][showData][date]     = array("name"=>"Termine-Verknüpfung","show"=>1,"type"=>"special","width"=>"standard");        $editShow[link][showData][date][tip] = "Artikelverknüpfungen sind nur möglich zu Terminen die den gleichen Veranstaltungsort aus der Datenbank haben!";        return $editShow;    }        function cacheRefresh($id,$saveData,$mode) {        if ($_SESSION[showLevel] >= 9) echo ("<h1>cacheRefresh($id,$saveData,$mode)</h1>");                cmsCache_deleteId("ausgabe.php", $id, array("box"));                // Archive        $cachePath = "archive/".$saveData[dateRange]; // ."/";        cmsCache_deleteId($cachePath, $id, array("box"));                                                if ($saveData[link]) {            $linkList = explode("|",$saveData[link]);            for ($i=0;$i<count($linkList);$i++) {                list ($linkType,$linkId) = explode(":",$linkList[$i]);                switch ($linkType) {                    case "date" :                         if (intval($linkId)) {                            cmsCache_deleteId("kalender.php", $linkId, array("short"));                            $dateData = cmsDates_getById($linkId);                            if ($_SESSION[userLevel] >= 9)  echo ("MORE DATES LINKES FOR MAIN DATE '$dateData[link]' <br>");                            if ($dateData[link]) {                                $linkList2 = explode("|",$dateData[link]);                                                                for ($k=0;$k<count($linkList2);$k++) {                                    list ($linkType2,$linkId2) = explode(":",$linkList2[$k]);                                    switch ($linkType2) {                                        case "date" :                                             $dateLinkId = explode(",",$linkId2);                                            for ($di=0;$di<count($dateLinkId);$di++) {                                                // if ($_SESSION[showLevel] >= 9) echo ("Linked Date for Date $linkId2 -> $dateLinkId[$di]<br>");                                                cmsCache_deleteId("kalender.php", $dateLinkId[$di], array("short"));                                            }                                            break;                                        case "article" :                                             // echo ("Linked Artikel for Date $linkId2 <br>");                                            break;                                    }                                }                            }                                                                                }                }                            }        }                        }                function editButtons_own($buttonList,$saveData) {        // show_array($buttonList);        // $buttonList = array();        if ($saveData[id]) {            $buttonList[save][name] = "Artikel speichern";                        if ($_SESSION[userLevel] >= 9) {                $addData = array();                $addData[type] = "submit";                $addData["class"] = "cmsInputButton cmsSecond";                $addData["value"] = "duplicate";                $addData[name] = "Artikel Duplizieren";                $buttonList[duplicate] = $addData;                // $addData[link] = "ausgabe.php?articleId=".$saveData[id];            }                    } else {            $buttonList[save][name] = "Artikel anlegen";        }                // Zeige Datensatz        if ($saveData[id]) {            $addData = array();            $addData[type] = "link";            $addData["class"] = "cmsLinkButton cmsSecond";            $addData[name] = "Artikel Zeigen";            $addData[link] = "ausgabe.php?articleId=".$saveData[id];            $buttonList[show] = $addData;        }                // new Article        $showNew = 1;        if ($showNew) {            $addData = array();            $addData[type] = "link";            $addData["class"] = "cmsLinkButton cmsSecond";            $addData[name] = "Neuen Artikel anlegen";            $addData[link] = "admin_articles.php?view=new";            $buttonList["new"] = $addData;        }                                return $buttonList;    }    function linkList_getArray($linkString) {       $linkList = explode("|",$linkString);        for ($i=0;$i<count($linkList);$i++) {            if ($linkList[$i]) {                $ofSet = strpos($linkList[$i],":");                $first = substr($linkList[$i],0,$ofSet);                $second = substr($linkList[$i],$ofSet+1);                $linkData[$first] = $first.":".$second; // explode(",",$second);            }        }        return $linkData;    }    function linkList_getString($linkData) {        $linkString = "";        foreach($linkData as $key => $value) {            if ($value) {                if ($linkString != "") $linkString .= "|";                $linkString .= $value;            }        }        return $linkString;    }    function editShowInput_special_own($key,$code,$dataName,$value,$titleStr,$editStyle,$editClass,$idStr,$readOnly,$disabled,$width,$height,$leftWidth) {        //  echo ("$key $code $dataName<br>");        // echo ("<input type='text' name='$dataName' value='$code'>");        $list = explode("|",$code);        $linkData = array();        $linkList = explode("|",$code);        for ($i=0;$i<count($linkList);$i++) {            $ofSet = strpos($linkList[$i],":");            $first = substr($linkList[$i],0,$ofSet);            $second = substr($linkList[$i],$ofSet+1);            $linkData[$first] = $first.":".$second; // explode(",",$second);        }        switch ($key) {//            case "article" ://                $code = $linkData[$key];//                $res = $this->editShowInput_articles($key,$code,$dataName,$value,$titleStr,$editStyle,$editClass,$idStr,$readOnly,$disabled,$width,$height,$leftWidth);//                return $res;//                break;            case "date" :                $code = $linkData[$key];                $res = $this->editShowInput_dates($key,$code,$dataName,$value,$titleStr,$editStyle,$editClass,$idStr,$readOnly,$disabled,$width,$height,$leftWidth);                return $res;                break;        }    }    function editShowInput_dates($key,$code,$dataName,$value,$titleStr,$editStyle,$editClass,$idStr,$readOnly,$disabled,$width,$height,$leftWidth) {        echo ($titleStr);         if (strlen($code)) {            $dateId = substr($code,strpos($code,":")+1);            // echo ("DateId $dateId<br>");        }        // echo ("editShowInput_dates($key,$code,$dataName<br>");        $divData = array();        $divData[style] = "width=".($width-10)."px;display:inline-block;";              $divData[date] = "2012-08-01";        $divData[dateUrl] = "/cms_$GLOBALS[cmsVersion]/getData/datesData.php?cmsVersion=$GLOBALS[cmsVersion]&cmsName=$GLOBALS[cmsName]&dataName=linkDate&out=dropdown";        $divData[dateId] = $dateId;        div_start("dateLink_box",$divData);        if ($_SESSION[showLevel] >= 9) {            echo ("<input type='text' name='link[date]' value='$code' readonly='readonly' style='width:".$width."px;'><br>");        } else {            echo ("<input type='hidden' name='link[date]' value='$code'>");        }        $dateName = "Termin verknüpfen";        if ($dateId) {            $dateData = cmsDates_getById($dateId);            if (is_array($dateData)) {                $dateName = $dateData[name];            }        }        div_start("dateSelector cmsJavaButton");// "padding:10px;background-color:#fcc;display:inline-block;");        echo ($dateName);        div_end("dateSelector cmsJavaButton");                if ($dateId) {            $goLink = "admin_cmsDates.php?view=edit&id=$dateId";            echo ("<a href='$goLink' class='cmsContentHeadInputButton' >editieren</a>");        }                div_Start("dateDropdownFrame");        // $showData = array("empty"=>"Artikel wählen","style"=>"width:".$width."px","class"=>"ArticleDropdown");        // echo (cmsArticles_selectArticles($articleId,"linkArticle",$showData,array("location"=>$locationId),"fromDate"));        div_end("dateDropdownFrame");        // echo ("editShowInput_articles($key,$code,$dataName,$value,$titleStr,$editStyle,$editClass,$idStr,$readOnly,$disabled,$width,$height,$leftWidth)<br>");        div_end("dateLink_box");        $break = 1;        return array("break"=>$break);    }    function linkDate($mode,$value,$linkData,$articleId) {        // echo ("linDate($mode,$value,$linkData)<br>");        switch ($mode) {            case "set" :                $dateStr = $linkData[date];                $dateId = substr($dateStr,strpos($dateStr,":")+1);                if (intval($dateId)) {                    echo ("REMOVE ArticleId = $articleId FROM DATE $dateId <br>");                    // echo ("DateId = $dateId <br>");                    $dateData = cmsDates_getById($dateId);                    if (is_array($dateData)) {                        $date_link = $dateData[link];                        // echo ("link = $date_link<br>");                        $date_linkData = $this->linkList_getArray($date_link);                        // show_array($date_linkData);                        $date_linkData[article] = "";                        $date_link = $this->linkList_getString($date_linkData);                        // echo ("new LinkString for Date : $date_link <br>");                        $query = "UPDATE `$GLOBALS[cmsName]_cms_dates` SET `link`='$date_link' WHERE `id`=$dateId";                        $result = mysql_query($query);                        if (!$result) {                            cms_errorBox("Error in Update Date by Remove Article to Date <br>$query");                        }                    }                }                if ($value) { // SETZE ARTICLE TO Date                    $dateId = $value;                    if (intval($dateId)) {                        $dateData = cmsDates_getById($value);                        if (is_array($dateData)) {                            $date_link = $dateData[link];                            // echo ("link = $date_link<br>");                            $date_linkData = $this->linkList_getArray($date_link);                            $date_linkData[article] = "article:$articleId";                            // show_array($date_linkData);                            $date_link = $this->linkList_getString($date_linkData);                            // echo ("new LinkString for Date : $date_link <br>");                            $query = "UPDATE `$GLOBALS[cmsName]_cms_dates` SET `link`='$date_link' WHERE `id`=$dateId";                            $result = mysql_query($query);                            if (!$result) {                                cms_errorBox("Error in Update Date by ADD Article to Date <br>$query");                            }                        }                    }                    $dateLink = "date:".$value;                } else { // REMOVE Date FROm Artikel                    $dateLink = "";                }                $linkData[date] = $dateLink;                $linkString = $this->linkList_getString($linkData);                // echo ("<h1>New LinkString = '$linkString' </h1>");                return ($linkString);                break;                           case "check" :                if ($_SESSION[showLevel]>=9) $out =1;                //  echo ("<h1>LinkCheck</h1>");                // show_array($value);                $dateStr = $value[date];                if ($dateStr) {                    list($linkType,$dateId) = explode(":",$dateStr);                    if ($out) echo ("$linkType $dateId<br>");                    if (intval($dateId)) {                        $dateData = cmsDates_getById($dateId);                        if (is_array($dateData)) {                            $date_link = $dateData[link];                            // echo ("link = $date_link<br>");                            $date_linkData = $this->linkList_getArray($date_link);                            if ($out) show_array($date_linkData);                            if ($date_linkData[article] == "article:$articleId") {                                if ($out) echo "Artikel ist veknüpft<br>";                                                                } else {                                $date_linkData[article] = "article:$articleId";                                if ($out) echo ("Update ArtikelId $articleId im Termin <br>");                                                                $newLinkStr = $this->linkList_getString($date_linkData);                                $query = "UPDATE `$GLOBALS[cmsName]_cms_dates` SET `link`='$newLinkStr' WHERE `id`=$dateId";                                $result = mysql_query($query);                                if (!$result) {                                    cms_errorBox("Error in Update Date by ADD Article to Date <br>$query");                                }                                if ($out) echo ("New linkStr = '$newLinkStr' <br>");                            }                        }                    }                }                                                   break;                                            default :                                                               if ($_SESSION[userLevel] >= 9) {                   echo ("unkown Link Mode $mode <br>");               }                         }    }         }?>