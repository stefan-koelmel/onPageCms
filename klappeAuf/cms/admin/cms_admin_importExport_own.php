<?php // charset:UTF-8 class cms_importExport extends cms_importExport_base {     function __init() {        $this->serverPath = "http://cms.stefan-koelmel.com/klappeAuf/cms/";        $this->phpGetFile = "get_Data.php";        $data = array();        $data[serverPath] = "http://www.stefan-koelmel.com/klappeAuf/";        // $data[serverPath] = "http://alt.klappeAuf.de/php/";        $data[phpGetFile] = "get_Data.php";        //$data[tables][startName]="klappe";        // $data[tables][contain]="date";        return $data;    }    function getLinkButtons_own() {        $res = array();        $res["printDates"] = array("name"=>"Export Printausgabe Termine","userLevel"=>5);        $res["importDates"] = array("name"=>"Import vom alten Mac-Programm Terminen","userLevel"=>6);        $res["exportLocation"] = array("name"=>"Export Location","userLevel"=>6);        return $res;    }    function showView_own($type,$frameWidth) {        $res = 1;        switch ($type) {            case "exportLocation" :                $res = $this->export_location($type,$frameWidth);                break;            case "importDates" :                if ($_POST[cancel]) {                    $goPage = $GLOBALS[pageInfo][page];                    cms_infoBox("Importieren abgebrochen");                    reloadPage($goPage, 1);                    return 1;                }                echo ("<h1>Import von alten Termin-Daten</h1>");                $serverPath = $_SERVER['DOCUMENT_ROOT'];                $path = $serverPath."/".$GLOBALS[cmsName]."/cms/admin";                if ($_POST[import]) {                    $selectFile = $_POST[selectFile];                    if ($selectFile) {                        echo ("Datei = $path $selectFile <br>\n");                        $str = loadText($path."/".$selectFile);                        if (strlen($str)) {                            $res = $this->importDateStr($str);                            if ($res == 1) {                                $goPage = $GLOBALS[pageInfo][page]."?view=importDates";                                cms_infoBox("Importieren abgeschlossen");                                reloadPage($goPage, 1);                                return 1;                            }                        }                                            } else {                        cms_infoBox("Keine Datei ausgewählt!");                    }                }                                // echo ("Path = $path<br>");                echo ("<form method='post' >\n");                $handle = opendir($path);                while ($file = readdir ($handle)) {                    if ($file != "." && $file != "..") {                        $dotList = explode(".",$file);                        if (count($dotList)==1) {                            echo "maybeFolder $file<br>";                        } else {                            $ending = $dotList[count($dotList)-1];                            $ending = strtolower($ending);                            switch ($ending) {                                case "txt" :                                    if ($file == $selectFile) $checked = "checked='checked'";                                    else $checked = "";                                    echo ("<input type='radio' name='selectFile' $checked value='$file'> $file<br>");                                    break;                                default :                                    // echo ("maybeFile $file -> $ending <br>");                            }                        }                    }                }                closedir($handle);                echo ("&nbsp;<br>");                echo ("<input type='submit' value='Importieren' name='import' class='cmsInputButton'>");                echo ("<input type='submit' value='abbrechen' name='cancel' class='cmsInputButton cmsSecond'>");                echo ("</form>");                break;            case "printDates" :                echo ("Export Termine für Hugi");                $cancelDates = $_POST[cancelDates];                if ($cancelDates) {                    $goPage = $GLOBALS[pageInfo][page];                    cms_infoBox("Export abgebrochen");                    reloadPage($goPage,1);                    return 1;                }                                list($year,$month) = explode("-",date("Y-m"));                $month = $month + 1;                if ($month>12) { $month = 1;$year++;}                $showForm = 1;                $getDates = $_POST[getDates];                if ($getDates) {                    $month = intval($_POST[month]);                    $year = intval($_POST[year]);                    if ($month >= 1 and $month <= 12) {                        if ($month <10) $month = "0".$month;                        else $month = "".$month;                        if ($year > 2005) {                            $this->exportPrintDate($year,$month);                            $showForm = 0;                        }                    }                }                if ($showForm) {                    echo ("<form method='post' >");                    echo ("Monat wählen: <input name='month' value='$month' style='width:20px' >");                    echo ("<input name='year' value='$year' style='width:40px' ><br>");                    echo ("<input type='submit' name='getDates' value='Terminliste erstellen' class='cmsInputButton'>");                    echo ("<input type='submit' name='cancelDates' value='abbrechen' class='cmsInputButton cmsSecond'><br>");                    echo ("</form>");                }                break;            default :                $res = 0;        }        return $res;    }    function export_location($type,$frameWidth) {               //echo ("export_location($type,$frameWidth);<br>");        $show_Select = 1;        $catList = 0;        if ($_POST[cancelLocation]) {            $goPage = $GLOBALS[pageInfo][pageName];            reloadPage($goPage,0);            return 1;        }        if ($_POST[exportLocation]) {            $export = $_POST[export];                        $catList = explode("|",$export[category]);        }         if ($show_Select) {            echo ("<h1>Export Locations</h1>");            echo ("<form method='post' >");            echo ("Kategorie wählen<br />");            $showData = array("class"=>"adminArticles_Category","count"=>4,"mode"=>"multi","width"=>$frameWidth);            $input = cmsCategory_selectCategory_toogle($export[category], "export[category]", $showData, array("mainCat"=>8,"show"=>1), "id");            echo ($input."<br>\n");            echo("&nbsp;<br>");            echo ("<input type='submit' name='exportLocation' value='Exportliste erstellen' class='cmsInputButton'>");            echo ("<input type='submit' name='cancelLocation' value='abbrechen' class='cmsInputButton cmsSecond'><br>");            echo ("</form>");        }               if (is_array($catList)) {            echo ("<h2>Export</h2>");            if (count($catList)>2) {                                $out = "";                $zb = "<br>";                $zb = "\r\n";                for ($i=1;$i<count($catList)-1;$i++) {                    $catId = $catList[$i];                    $catName = cmsCategory_getName_byId($catId);                    $out .= $catName.$zb.$zb;                    $locationList = cmsLocation_getList(array("category"=>$catId,"show"=>1),"name");                    echo ("export Kategory : $catName Anzahl=".count($locationList)."<br>");                    for ($l=0;$l<count($locationList);$l++) {                        $location = $locationList[$l];                        $name = $location[name];                        $out .= $name.$zb;                        // TitleLine                        // Adress                        $adr = "";                        if ($location[street] OR $location[streetNr]) {                            if ($adr) $adr.= ", ";                            if ($location[street]) $adr.= $location[street];                            if ($location[streetNr]) $adr.= " ".$location[streetNr];                        }                        if ($location[plz] OR $location[city]) {                            if ($adr) $adr.= ", ";                            if ($location[plz]) $adr.= trim($location[plz])." ";                            if ($location[city]) $adr.= trim($location[city]);                        }                        if ($location[phoneRegion] OR $location[phonePhone]) {                            if ($adr) $adr.= ", ";                            if ($location[phoneRegion]) $adr.= trim($location[phoneRegion])."-";                            if ($location[phonePhone]) $adr.= trim($location[phonePhone]);                        }                        // Öffnungszeiten                        if ($location[data][open]) {                            if ($adr) $adr.= ", ";                            $adr .= trim($location[data][open]);                        }                        if ($location[url]) {                            if ($adr) $adr.= ", ";                            $adr .= $location[url];                        }                        if ($adr) {                            $out .= $adr.$zb;                        }                        // text                        $text = "";                        if (is_array($location[data])) {                            if ($location[data]["info_".$catId]) {                                $text = $location[data]["info_".$catId];                            } else {                                if ($location[data]["notice"]) {                                    $text = $location[data]["notice"];                                }                            }                        }                        if (!$text) {                            if ($location[info]) {                                $text = $location[info];                            }                        }                        if (!$text) {                           // echo ("kein Text für Location $name<br>");                        } else {                            //                            $text = str_replace("‘","&lsquo;",$text); 	// ´	einfaches Anführungzeichen                            //$text = str_replace("’","&rsquo;",$text); // 		einfaches Anführungzeichen 	right single quote                            //$text = str_replace("‚","&sbquo;",$text); //		einfaches unteres Anführungszeichen 	single low-9 quote                            //$text = str_replace("“","&ldquo",$text); // 		Anführungszeichen 	left double quote                            //$text = str_replace("”","&rdquo;",$text); //		Anführungszeichen 	right double quote                            //$text = str_replace("„","&bdquo;",$text); // 		Anführungszeichen unten 	double low-9 quote                            //                            //                            //                            //                            //                            //                            $text = str_replace("´","&#180;",$text);                            //                            $text = str_replace("„","&#132;",$text);                            //                            $text = str_replace("“","&#147;",$text);                            //                            $text = str_replace("‟","###",$text);                            // $text = htmlspecialchars($text, ENT_QUOTES);                            //$text = htmlspecialchars_decode($text);                            // $text = htmlspecialchars_decode($text);                            // $text = html_entity_decode($text,"ENT_QUOTES","UTF-8");                            $out .= $text.$zb;                        }                        $out .= $zb;                    }                    $out.= $zb.$zb;                }                // echo($out);                //$out = html_entity_decode($out,"ENT_QUOTES","UTF-8");                // Save                $serverPath = $_SERVER['DOCUMENT_ROOT'];                // echo ($serverPath."/$GLOBALS[cmsName] <br>");                if (file_exists($serverPath."/$GLOBALS[cmsName]/")) {                    $path = "/".$GLOBALS[cmsName]."/export/location/";                } else {                    $path = "/export/location/";                }                // echo ($path."<br>");                echo ("&nbsp;<br>");                $saveUTF8 = 1;                if ($saveUTF8) {                    // $strIso = iconv("utf-8","iso-8859-15",$out);                    $fn   = "location-utf8.txt";                    saveText("\xEF\xBB\xBF".$out,$serverPath.$path.$fn);                    echo ("<a href='".$path.$fn."' target='export' class='cmsLinkButton' >Anzeigen UTF8</a>");                    echo ("<a href='".$path."downloadFile.php?file=".$fn."' target='export' class='cmsLinkButton cmsSecond'>Download UTF8</a><br>");                }                //echo ("Länge Str = ".strlen($out)."<br>");                // echo ("FileSize ".filesize($serverPath.$path.$fn)."<br>");                $saveIso = 0;                if ($saveIso) {                    $strIso = iconv("utf-8","iso-8859-15",$out);                    $fn   = "location-iso.txt";                    saveText($strIso,$serverPath.$path.$fn);                    echo ("<a href='".$path.$fn."' target='export' class='cmsLinkButton' >Anzeigen ISO</a>");                    echo ("<a href='".$path."downloadFile.php?file=".$fn."' target='export' class='cmsLinkButton cmsSecond'>Download ISO</a><br>");                    echo ("Länge Str = ".strlen($out)."<br>");                    echo ("FileSize ".filesize($serverPath.$path.$fn)."<br>");                }                                $saveMac = 0;                if ($saveMac) {                    $str2 = iconv("utf-8","macintosh",$out);                    $fn2   = "location-mac.txt";                    // echo ($serverPath."--".$path."..".$fn2."<br>");                    saveText($str2,$serverPath.$path.$fn2);                    echo ("<a href='".$path.$fn2."' target='export' class='cmsLinkButton' >Anzeigen MAC</a>");                    echo ("<a href='".$path."downloadFile.php?file=".$fn2."' target='export' class='cmsLinkButton cmsSecond'>Download Mac</a><br>");                }                // echo ($out);            } else {                echo ("<br><strong>keine Kategorie ausgewählt </strong><br>");            }        }        return 1;    }    function importDateStr($str) {                // CategoryList        $categoryList = cmsCategory_getList(array("mainCat"=>1),"","assoName"); //, $sort)        // show_array($categoryList);        // RegionList        $regionList = cmsCategory_getList(array("mainCat"=>180),"","assoName"); //, $sort)        //show_array($regionList);        $t = $str; //loadText($fn);         echo ("Lange: ".strlen($t)."<br>");               $t = iconv("macintosh","utf-8", $t);        $spacer = $t[1].$t[2].$t[3];        echo("Lange nach Zeichenumwandlung:".strlen($t)."<br>");        // echo ("String = ".substr($t,$off,400)."<br>");//         for ($i=1;$i<20;$i++) {//            echo ("Zeichen $i = $t[$i], ".ord($t[$i])."<br>");//        }       $tList = explode($spacer,$t);       echo ("Anz Zeilen $spacer = ".count($tList)."<br>");        $step = 0;        $anz = count($tList);        // $anz = 20;        $dayList = array();        $datesAdded = 0;        for ($i=1;$i<$anz;$i++) {            $inh = $tList[$i];            if ($step == 0) {                $termin = array();                $termin["date"] = $inh;               //  echo("<strong>$i - $step - $tList[$i] </strong><br>");                $step = 1;            } else {                switch ($step) {                    case 1 : $termin["category"] = $inh; break;                    case 2 : $termin["region"] = $inh; break;                    case 3 : $termin["name"] = $inh; break;                    case 4 : $termin["info"] = $inh; break;                    case 5 : $termin["location"] = $inh; break;                    case 6 : $termin["time"] = $inh; break;                    default :                        echo("$i - $step - $tList[$i]<br>");                }                $step++;                if ($step>6) {                    $step = 0;                    $day = $termin[day];                    //echo ("Add Termin am $day <br>");                    if (!is_array($dayList[$day])) $dayList[$day] = array();                    $dayList[$day][] = $termin;                    $show = 0;                    $infoStr = $termin["info"];                    $open = 0;                    $start = strpos($infoStr,"$$");                    if (is_integer($start)) {                        // echo ("before : $infoStr -$start <br>");                        while (is_integer($start)) {                            if ($open) { $add = "</b>"; $open=0;}                            else { $add = "<b>"; $open=1;}                            $infoStr = substr($infoStr,0,$start).$add.substr($infoStr,$start+2);                            $start = strpos($infoStr,"$$");                        }                        // echo ("After : $infoStr $start <br>");                        $termin[info] = $infoStr;                    }                                       // Convert Kategorie                    $categoryName = $termin[category];                    if (!$categoryList[$categoryName]) {                        echo ("Not Found $categoryName in date_kat <br>");                        die();                    } else {                        $termin["category"] = $categoryList[$categoryName];                        // echo ("found Category id = $date_kat[$categoryName] '$type'<br>");                    }                    // Convert Region                    $regionName = $termin[region];                    if (!$regionList[$regionName]) {                        echo ("Region $regionName not found <br>");                        die();                    } else {                        $termin["region"] = $regionList[$regionName];                        // echo ("found Region id = $date_region[$regionName] '$regionName'<br>");                    }                    // Convert Location                    $locationStr = $termin[location];                    if ($locationStr) {                        $offset = strpos($locationStr,"(");                        if ($offset > 0) {                            $locationName = substr($locationStr,0,$offset-1);                            $long = strlen($locationStr) - $offset - 2;                            $adress = substr($locationStr,$offset+1,$long);                            //echo ("Location = '$locationStr' <br>");                            //echo ("Locton '$locationName' (-$adress-)<br>");                        } else {                            $locationName = $locationStr;                            $adress = "";                            // echo ("Location = '$locationStr' <br>");                            // echo ("kein Offset Location is '$locationName' <br>");                        }                        $locationData = cmsLocation_get(array("name"=>$locationName));                        if (is_array($locationData)) {                            $id = $locationData[id];                            $name = $locationData[name];                            $street = $locationData[street];                            $streetNr = $locationData[streetNr];                            //echo ("Location $locationName Found $id / $name <br>");                            // if ($adress) echo ("  $adress <-> $street $streetNr <br>");                            $termin[location] = $id;                            //show_array($locationData);                        } else {                            // echo ("Location $locationName not found <br>");                            $termin[location] = "";                            $termin[locationStr] = $locationName;                            $termin[data][street] = $adress;                        }                    } else {                        //echo "no Location <br>";                        // echo ("Location = '$locationStr' <br>");                    }                    $time = $termin["time"];                    if (strlen($time)== 9) $time = substr($time,0,8);                    if (strlen($time)== 12) $time = substr($time,0,8);                    if (strlen($time)== 11) $time = substr($time,0,8);                    if (strlen($time)== 8) {                        $termin[time] = $time;                    } else {                        echo ("No Time is $time ".strlen($time)."<br>");                        die();                    }                    $day = $termin[date];                    $y = subStr($day,6,4);                    $m = substr($day,3,2);                    $d = substr($day,0,2);                    $date = $y."-".$m."-".$d;                    $termin[date] = $date;                    // echo ("Datum $date <br>");                    $termin[show] = 1;                    $termin[data]["print"]=1;                    $res = cmsDates_save($termin);                    if ($res != 1) {                        echo ("Result is $res <br>");                        die();                    } else {                        $datesAdded++;                    }                    $show = 0;                    if ($show) {                        echo ("<b>Add Termin am $day </b><br>");                        foreach ($termin as $key => $value) {                           //if (strlen($value)<3) echo ("<strong>");                           echo ("$key = $value");                           //if (strlen($value)<3) echo ("</strong><br>");                           echo ("<br>");                        }                    }                }            }        }        echo ("<b>$datesAdded Termine hinzugefügt / aktuallisiert </b><br>");        return 1;    }    function exportPrintDate($year,$month) {        echo ("<h1>Termine für $month-$year</h1>");        $filter = array();        $filter[show] = 1;       // $filter[data] = "!=''";        $filter[fromDate] = $year."-".$month."-01";        $filter[toDate] = $year."-".$month."-31";                $sort = "time";        $regionList = cmsCategory_getList(array("mainCat"=>180,"show"=>1),"id","assoId");        $catList = cmsCategory_getList(array("mainCat"=>1,"show"=>1),"id","assoId");                        unset($catList[327]); // Ausstellungen        unset($catList[330]); // Kunst               //  show_array($catList);                $dateList = cmsDates_getList($filter, $sort);        $sortetDateList = $this->dates_getSortetList($dateList,$regionList,$catList);        $str = "";        //$str.= "<v2.05><e2>\r\n";        $delimiter = " · ";                $textStr= "";                foreach ($sortetDateList as $date => $dateData) {                       $addDateStr = "";            $addTextDateStr = "";            foreach ($dateData as $category => $categoryData) {                $catString = $catList[$category];                // Printausgabge                $addCatStr = "";                // Textausgabe                $addTextCatStr = "";                                foreach($categoryData as $region => $regionData) {                    $regionStr = $regionList[$region];                    $addRegionStr = "";                    // Textausgabe                    $addTextRegionStr = "";                    if (is_array($regionData) AND count($regionData)) {                        for ($i=0;$i<count($regionData);$i++) {                                                        $id =  $regionData[$i][id];                            $name =  $regionData[$i][name];                            $subName =  $regionData[$i][subName];                            $info =  $regionData[$i][info];                            $time =  $regionData[$i][time];                            $timeStr = cmsDate_getTimeString($time);                            $location =  $regionData[$i][location];                            $data =  $regionData[$i][data];                            if ($location>0) {                                $locationData = cmsLocation_getById($location);                                if (is_array($locationData)) {                                    $street = $locationData[street];                                    $streetNr = $locationData[streetNr];                                    $locationName = $locationData[name];                                }                            } else {                                $street = $data[street];                                $locationName =  $regionData[$i][locationStr];                                $streetNr = "";                                // echo ("$locationName $street $streetNr<br>");                            }                            $locationStr = "";                            if ($locationName) $locationStr .= $locationName;                            if ($street) $locationStr .= " (".$street." ".$streetNr.")";                                                        $addList = array();                            if ($name)        $addList[] = "<b>".$name."</b>";// $name;                            if ($subName)     $addList[] = $subName;                            if ($info)        $addList[] = php_clearOutPut($info,0);                            if ($locationStr) $addList[] = $locationStr;                            if ($timeStr)     $addList[] = $timeStr;                            $addStr = "";                            for ($a=0;$a<count($addList);$a++) {                                if  ($addStr != "") $addStr .= $delimiter;                                $addStr.=$addList[$a];                            }                            $beforeLength = strlen($addStr);                                                        // TextAusgabe                            $addTextRegionStr .= $addStr."<br>";                                                       //  $addStr = html_entity_decode($addStr);                                                        //$addStr = str_replace("&#180;",  "<\#171>", $addStr);  // ?                            $addStr = str_replace("?",  "<\#171>", $addStr); // ?                            // $addStr = str_replace("&acute;",  "<\#171>", $addStr); // ?;                            // $addStr = str_replace("&#034;",  "<\#211>", $addStr); // "                                                                                 $addStr = $this->addToOutput($addStr);                                                                                    $addRegionStr .= $addStr."\r\n";                        }                    }                                       if ($addRegionStr) {                                                // Textausgabe                        $addTextCatStr .= "<h3>$regionStr</h3>";                        $addTextCatStr .= "$addTextRegionStr";                                                // Print ausgabe                        $addCatStr .= "@Term.ORT:".$regionStr."\r\n";                        // $addCatStr .= "<h3>$regionStr</h3>";                        $addCatStr .= "@Term.Brot:".$addRegionStr;                    }                }                               if ($addCatStr) {                    // Textausgabe                    $addTextDateStr .= "<h2>$catString</h2>";                    $addTextDateStr .= $addTextCatStr;                                        // Print ausgabe                    $addDateStr .="@Term.RUBRIK:".$catString."\r\n";                    $addDateStr .= $addCatStr;                }            }            if ($addDateStr) {                list($year,$month,$day) = explode("-",$date);                $year  = intval($year);                $month = intval($month);                $day  = intval($day);                $dateStr = $day.".".$month.".".$year;                $wochenTag = cmsDate_getDayString($date,"only");                                $textStr .= "<h1>$wochenTag : $day </h1>";                $textStr .= $addTextDateStr;                                // $str .= "@Über.TAG:".$wochenTag."\r\n"."@Über.DATUM:".$day.".<\c>\r\n";                $str .= "@Über.TAG:".$wochenTag."\r\n"."@Über.DATUM:".$day.".\r\n";                $str .= $addDateStr;                            }        }                       // echo ("$textStr <br>");                // Sonderzeichen        $showAscII = 1;        if ($showAscII) {            $asciiStr = "";            for ($i = 32;$i<255;$i++) {                $asciiStr .= "$i - <\#$i>\r\n";            }        }        $serverPath = $_SERVER['DOCUMENT_ROOT'];        //echo ("ServerPath $serverPath<br>");        //echo (" with cmsName ".$serverPath."/".$GLOBALS[cmsName]."/ <br>");                if (file_exists("$serverPath/$GLOBALS[cmsName]")) {           // echo ("exist $GLOBALS[cmsName] <br>");        }                if (file_exists("$serverPath/$GLOBALS[cmsName]")) {            $path = "/".$GLOBALS[cmsName]."/export/dates/";        } else {            $path = "/export/dates/";        }        // echo ("Path = $path <br>");                                $saveIso = 0;        if ($saveIso) {            $strIso = iconv("utf-8","iso-8859-15","<v2.05><e2>\r\n".$str);            $fn   = "dateList-$year-$month.txt";            saveText($strIso,$serverPath.$path.$fn);            echo ("Save ISO TO ".$serverPath.$path.$fn." <br>");            echo ("<a href='".$path.$fn."' target='export' class='cmsLinkButton' >Anzeigen ISO</a>");            echo ("<a href='".$path."downloadFile.php?file=".$fn."' target='export' class='cmsLinkButton cmsSecond'>Download ISO</a><br>");        }                $saveMac = 1;        if ($saveMac) {            echo ("<h1>Dateien für Quark-Xpress</h1>");            // $str = $asciiStr.$str;            $str2 = iconv("utf-8","macintosh","<v2.05><e0>\r\n".$str);            $fn2   = "dateList-$year-$month-mac.txt";            // echo ($serverPath."--".$path."..".$fn2."<br>");            saveText($str2,$serverPath.$path.$fn2);            echo ("<a href='".$path."downloadFile.php?file=".$fn2."' target='export' class='cmsLinkButton '>Download</a>");            if ($_SESSION[showLevel]>=9) echo ("<a href='".$path.$fn2."' target='export' class='cmsLinkButton cmsSecond' >Anzeigen</a>");            echo ("<br>");        }                $saveTextVersion = 1;        if ($saveTextVersion) {            echo ("<h1>Textausgabe</h1>");            $fn   = "dateList-$year-$month.html";            // saveText("\xEF\xBB\xBF".$out,$serverPath.$path.$fn);            $textStr = "\xEF\xBB\xBF".header('Content-Type: text/html; charset=UTF-8').$textStr;            saveText($textStr,$serverPath.$path.$fn);            // echo ("Save TextFile ".$serverPath.$path.$fn." <br>");            echo ("<a href='".$path.$fn."' target='export' class='cmsLinkButton' >TextVersion</a>");            echo ("<a href='".$path."downloadFile.php?file=".$fn."' target='export' class='cmsLinkButton cmsSecond'>Download TextVersion</a><br>");        }    }    function addToOutput($str) {        //"@Term.Brot:<@TerminBrotFETT>".$name."<@\$p>";// $name;        // <@TerminBrotFETT>Sandkorn<@$p>                        // Zeilenumbrüche entfernen        $str = str_replace(array("\r","\n"), "", $str);                        // Bold neu -> sollte nicht vorkommen        $offSet_bold = strpos($str,"#f#");        $open_bold = 0;        while (is_int($offSet_bold)) {            if ($open_bold) {                $add ="<@\$p>";                $open_bold = 0;            } else {                $add = "<@TerminBrotFETT>";                $open_bold = 1;            }            $str = substr($str,0,$offSet_bold).$add.substr($str,$offSet_bold+3);                    $offSet_bold = strpos($str,"#f#");                }        if ($open_bold)  $str.="<@\$p>";                // Bold alt        $str = str_replace("<b>","<@TerminBrotFETT>", $str);        $str = str_replace("</b>","<@\$p>", $str);                // Anfürhungszeichen        $str = str_replace(array("'",'"',"&#034;"),"#A#", $str);                        // doppelte Anführungszeichen        $offSet_quote = strpos($str,"#A#");        $open_quote = 0;        while (is_int($offSet_quote)) {            if ($open_quote) {                $add = "<\#210>";                $open_quote = 0;            } else {                $add ="<\#227>";                 $open_quote = 1;            }            $str = substr($str,0,$offSet_quote).$add.substr($str,$offSet_quote+3);                    $offSet_quote = strpos($str,"#A#");                }        if ($open_quote) $str.="&ldquo;";                                // einfache Anführungszeichen        $offSet_quote = strpos($str,"#a#");        $open_quote = 0;        while (is_int($offSet_quote)) {            if ($open_quote) {                $add = "<\#226>";                $open_quote = 0;            } else {                $add ="<\#212>";                 $open_quote = 1;            }            $str = substr($str,0,$offSet_quote).$add.substr($str,$offSet_quote+3);                    $offSet_quote = strpos($str,"#a#");                }        if ($open_quote) $str.="&ldquo;";                                return $str;                                $str = str_replace("<b>","<@TerminBrotFETT>", $str);        $str = str_replace("</b>","<@\$p>", $str);        return $str;        $offSet = strpos($str, "$$");        if ($offSet > 0) {            //echo ("Str has Zeichen $$ '$str' <br>");            $newStr = substr($str,0,$offSet)."<@TerminBrotFETT>".substr($str,$offSet+2);            //echo ("NEW STRING is $newStr<br>");            $offSet2 = strpos($newStr, "$$");            if ($offSet2 > 0) {                $str = substr($newStr,0,$offSet2)."<@\$p>".substr($newStr,$offSet2+2);            }            $str = addToOutput($str);            // echo ("NEW STRING is $str<br>");        }        return $str;    }            function addToTextOutput($str) {        //$str = str_replace("<b>","<@TerminBrotFETT>", $str);        //$str = str_replace("</b>","<@\$p>", $str);        return $str;        $offSet = strpos($str, "$$");        if ($offSet > 0) {            //echo ("Str has Zeichen $$ '$str' <br>");            $newStr = substr($str,0,$offSet)."<@TerminBrotFETT>".substr($str,$offSet+2);            //echo ("NEW STRING is $newStr<br>");            $offSet2 = strpos($newStr, "$$");            if ($offSet2 > 0) {                $str = substr($newStr,0,$offSet2)."<@\$p>".substr($newStr,$offSet2+2);            }            $str = addToOutput($str);            // echo ("NEW STRING is $str<br>");        }        return $str;    }        function dates_getSortetList($dateList,$regionList,$catList) {        // Create Empty Day Array        $emptyDate = array();        // Create empty Region Array        $emptyRegion = array();        foreach ($regionList as $regionId => $regionName) {            // echo ("Region $regionId = $regionName <br>");            $emptyRegion[$regionId] = array();        }        // create empty Category Array        foreach($catList as $catId => $catName) {            // echo ("Category $catId = $catName <br>");            $emptyDate[$catId] = $emptyRegion;        }        $res = array();                $addTip = 1;                        for ($i=0;$i<count($dateList);$i++) {            $date = $dateList[$i][date];            $category = $dateList[$i][category];            switch ($category) {                case 330 : break; // Kunst                case 327 : break; // Ausstellungen                default :                    $region  = $dateList[$i][region];                    if ($region == 192) $region = 187; // Region -> Umland Karlsruhe                    $id = $dateList[$i][id];                    $data  = $dateList[$i][data];                    $link  = $dateList[$i][link];                    $cancel = $dateList[$i][cancel];                    $highlight = $dateList[$i][highlight];                    $print = $dateList[$i]["print"];                    $addToText = 1;                    if (!$print) $addToText = 0;                    if ($cancel) $addToText = 0;                    if (!$addTip AND $highlight) $addToText = 0;                     if ($addToText) {                        if (!is_array($res[$date])) {                            $res[$date] = $emptyDate;                        }                        if (is_array($res[$date])) {                            if (is_array($res[$date][$category])) {                                if (is_array($res[$date][$category][$region])) {                                    $res[$date][$category][$region][] = $dateList[$i];                                } else {                                    echo ("not exist Region ($region) in category <br>");                                }                            } else {                                echo "Not exist Category ($category) in date <br>";                            }                        } else {                            echo "Not exist Date in Res <br>";                        }                    } else {                        $id = $dateList[$i][id];                        $name = $dateList[$i][name];                        echo ("Nicht Printausgabe $id $name an $date print=$print cancel=$cancel highlight=$highlight<br>");                        // echo (" DATA = (".show_array($data)." <br>");                        // show_array($data);                    }                        }                                                            }        ksort($res);        return $res;    }    function convertData_own($tableName,$data) {        $res = "no Conversion for KlappeAuf table '".$tableName."'";        switch ($tableName) {            case "klappe_alt_termine" :                $res = $this->klappe_convertTermine($data);                break;            case "klappe_alt_location_index" :                $res = $this->klappe_convertLocationIndex($data);                break;            case "klappe_alt_locations" :                $res = $this->klappe_convertLocation($data);                break;            case "locations" :                $res = $this->klappe_convertLocation($data);                break;            case "inhalte" :                $res = $this->klappe_articles($data);                break;            case "klappe_date_dates" :                $res = $this->klappe_convertTemine_new($data);                break;        }        return $res;    }    function archive_getMain_Sub_Cat($mainCatId) {        $res = "";        switch ($mainCatId) {            case 145 : $res = "dontAdd"; break;            case 146 : // Ausstellungen                $res=array("mainCat"=>307,"subCat"=>309); break;            case 147 : $res = "dontAdd"; break;            // case 147 : // Ausstellungstermine            //      $res=array("mainCat"=>307,"subCat"=>309); break;            case 148 : $res = "dontAdd"; break;            case 149 : $res = "dontAdd"; break;            case 150 : $res = "dontAdd"; break;            case 151 : // Buchtipps                $res=array("mainCat"=>310,"subCat"=>313); break;            case 152 : $res = "dontAdd"; break;            // case 152 : // Club News            //    $res=array("mainCat"=>318,"subCat"=>323); break;            case 153 : // Comedy                $res=array("mainCat"=>304,"subCat"=>306); break;            case 154 : $res = "dontAdd"; break; // djHeiko            case 155 : // Dr. Mabuse                $res=array("mainCat"=>310,"subCat"=>315); break;            case 156 : // Events                $res=array("mainCat"=>300,"subCat"=>303); break;            case 157 : // Film                $res=array("mainCat"=>310,"subCat"=>314); break;            case 158 : // Film                $res=array("mainCat"=>310,"subCat"=>314); break;            case 159 : $res = "dontAdd"; break; // Freibäder            case 160 : $res = "dontAdd"; break; // FreizeitTipps            case 161 : $res = "dontAdd"; break; // Gastro News            // case 161 : // Gastro News            //     $res=array("mainCat"=>318,"subCat"=>324); break;            case 162 : // Inhalt                $res=array("mainCat"=>310,"subCat"=>311); break;            case 163 : // Klassik                $res=array("mainCat"=>300,"subCat"=>302); break;            case 164 : // Kunst Aktuell                $res=array("mainCat"=>307,"subCat"=>308); break;            case 165 : // Lesungen                $res=array("mainCat"=>310,"subCat"=>312); break;            case 166 : // Local Heroes                $res=array("mainCat"=>300,"subCat"=>301); break;            case 167 : $res = "dontAdd"; break; // Lokalkultur            case 168 : // Meldungen                $res=array("mainCat"=>310,"subCat"=>311); break;            case 169 : $res = "dontAdd"; break; // 	Musik in Kneipen	löschen            case 170 : $res = "dontAdd"; break; // 	Partys	löschen            case 171 : $res = "dontAdd"; break; // 	Polizeimeldungen	löschen            case 172 : $res = "dontAdd"; break; // 	Raucherbereiche	löschen            case 173 : $res = "dontAdd"; break; // 	Schwimmbäder	löschen            case 174 : $res = "dontAdd"; break; // 	Sportmeldungen	löschen            case 175 : // Theater                $res=array("mainCat"=>304,"subCat"=>305); break;            case 156 : // Events                break;            case 176 : $res = "dontAdd"; break; //Tipps für Kids	löschen            case 177 : $res = "dontAdd"; break; // Verlosungen	löschen            case 178 : $res = "dontAdd"; break; // Weihnachten	löschen            case 179 : $res = "dontAdd"; break; // Wintersport	löschen            case 297 : $res = "dontAdd"; break; // Kino	löschen            // case 298 : $res = "dontAdd"; break; // Eventle	303            case 298 : // Events                $res=array("mainCat"=>300,"subCat"=>303); break;            case 299 : $res = "dontAdd"; break; // Filme etc.	löschen        }        return $res;    }    function klappe_articles($data) {        $newData = array();        $newData[data] = array();        $catList = $GLOBALS[catList];        if (!is_array($catList)) {            $rubrikList  = cmsCategory_getList(array("mainCat"=>144));            $catList = array();            for ($i=0;$i<count($rubrikList);$i++) {                $id = $rubrikList[$i][id];                $name = $rubrikList[$i][name];                //echo ("name $name -> $id<br>");                $catList[$name] = $id;            }            $GLOBALS[catList] = $catList;        }        //$dateRangeList = $GLOBALS[dateRangeList];        /*$dateRangeList = "";        if (!is_array($dateRangeList)) {            //$rangeList  = cmsCategory_getList(array("mainCat"=>140,"show"=>0));            $dateRangeList = array();            for ($i=0;$i<count($rangeList);$i++) {                $id = $rangeList[$i][id];                $name = $rangeList[$i][name];                echo ("Klappe Auf Ausgaben $name -> $id<br>");                $dateRangeList[$name] = $id;            }            $GLOBALS[dateRangeList] = $dateRangeList;        }*/        foreach ($data as $key => $value) {            switch ($key) {               case "id" :                   $newData[id]=$value;                   //echo ("set $key = $value <br>");                   break;                case "index_monat" :                    $dateRange = str_replace("_","-", $value);                    $newData[dateRange] = $dateRange;//                    if ($dateRangeList[$dateRange]) {//                        $newData[dateRange] = $dateRangeList[$dateRange];//                    } else {//                        echo ("DateRange not found $key = $value '$dateRange' <br>");//                    }                   break;                case "bereich" :                    if ($value) {                        // echo ("set $key = $value <br>");                    }                    break;                                   case "TC" :                    if ($value != "nein") {                        echo ("set $key = $value <br>");                    }                    break;                case "art" :                    if ($value) {                        // echo ("set $key = $value <br>");                    }                    break;                case "prioritaet" :                    if ($value) {                       // echo ("set $key = $value <br>");                    }                    $newData[sort] = $value;                    break;                                   case "stand" :                    if ($value) {                        // echo ("set $key = $value <br>");                    }                    $newData[lastMod] = $value;                    break;                case "von" :                    if ($value) {                        $startDate = substr($value,0,10);                        $newData[fromDate] = $startDate;                        //echo ("set $key = '$startDate' <br>");                    }                    break;                case "bis" :                    if ($value) {                        $endDate = substr($value,0,10);                        $newData[toDate] = $endDate;                        //echo ("set $key = '$endDate' <br>");                    }                    break;                case "name_art" :                    switch ($value) {                        case "Ausflugtipps" : $value = "Ausflugstipps"; break;                        case "Ausstellungs-termine" : $value ="Ausstellungstermine"; break;                    }                   if ($catList[$value]) {                       $oldId = $catList[$value];                       $mainSub = $this->archive_getMain_Sub_Cat($oldId);                       if (is_array($mainSub)) {                           $newData[category] = $mainSub[mainCat];                           $newData[subCategory] = $mainSub[subCat];                           // echo ("Set $value to $mainSub[mainCat] / $mainSub[subCat]<br>");                       } else {                           $newData[category] = $oldId;                           echo ("Not Found $value $oldId <br>");                       }                    } else {                        if ($value) {                            echo ("set $catList $key = $value <br>");                        }                    }                    break;                case "header" :                    // $value = iconv("ISO-8859-15","UTF-8",$value); // iconv("iso-8895-15","utf-8",$value);                    $newData[name] = $value;                    if ($value) {                        $newData[name] = $value;                        //echo ("set $key = $value <br>");                    }                    break;//  echo ("set $key = $value <br>");                                   case "sub_header" :                   $newData[subName] = $value;                   // echo ("set $key = $value <br>");                   break;                case "inhalt" :                   $newData[info] = $value;                   //echo ("set $key = $value <br>");                   break;                case "bild" :                    $dateRange = $newData[dateRange];                    $imageFile = $value;                    if ($imageFile) {                        // echo ("'$imageFile' in $dateRange <br>");                        if ($dateRange) {                            $folder = "images/articles/$dateRange/";                            $imageData = cmsImage_get(array("orgpath"=>$folder,"fileName"=>$imageFile));                           // echo ("Folder = $folder $imageData<br>");                            if (is_array($imageData)) {                                $imageId = $imageData[id];                                echo "ImageData erhalten $imageId <br>";                                $newData[image] = "|".$imageId."|";                            } else {                                echo ("Image not found in flde '$folder' File = '$imageFile' <br>");                            }                        }                    }                    if (!$imageId) {                       $newData[data]["imageStr"] = php_clearStr($value);                    }                   // echo ("set $key = $value <br>");                   break;                case "ort" :                    $newData[data]["ort"] = php_clearStr($value);                    //if ($value) {                       //echo ("set $key = $value <br>");                    //}                    break;                case "link" :                   $newData[url] = $value;                   //echo ("set $key = $value <br>");                   break;                case "verlosung" :                    if ($value) {                        $newData[data]["verlosung"] = php_clearStr($value);                    }                    break;                case "aktiv" :                   if ($value == "ja") $newData[show] = 1;                   else $newData[show] = 0;                   // echo ("set $key = $value <br>");                   break;               default :                   echo ("unkown $key = $value <br>");            }        }//        id//	 name//	 info//	 fromDate//	 toDate//	 dateRange//	 category//	 region//	 location//	 url//	 ticketUrl//	 sort//	 image//	 data//	 show        return $newData;    }    function klappe_convertTermine($data) {        $newData = array();        foreach ($data as $key => $value) {            switch ($key) {               case "ID" :                    $newData[id] = $value;                    break;                case "DATUM" : // = 20.02.2006                    $dateList = explode(".",$value);                    $date = $dateList[2]."-".$dateList[1]."-".$dateList[0];                    $newData[date] = $date;                    break;                case "THEME" : //  Lesung                    switch ($value) {                        case "Lesung" : $value="Lesung/Vortrag"; break;                    }                    $category = cmsCategory_getByName($value,1);                    if (is_array($category)) {                        echo ("$key = $value <br>");                        $newData[category] = $category[id];                    } else {                        echo ("Termin Kategorie nicht gefunden <br>");                        return 0;                    }                case "REGION" : // = Bad Herrenalb                    break;                case "TITEL" : //  = Nur wer für die Juden schreit, darf gregorianisch singen                    $newData[headline] = $value;                    break;                case "INHALT" : // = 20.-22.2. Tagung zum 100. Geburtstag Dietrich Bonhoeffers                    $newData[text] = $value;                    break;                case "VERANSTALTER" ://  = Evang. Akademie, Dobler Str. 51, 76332 Bad Herrenalb                    echo ("Veranstalter : $value <br>");                    $location = cmsLocation_get(array("name"=>$value));                    if (is_array($location)) {                        echo ("<h1> Location gefunden </h1>");                        show_array($location);                        $newData[location] = $location;                    }                                        break;                case "URL" : // = http://www.ev-akademie-baden.de                    $newData[url] = $value;                    break;                case "UHRZEIT" : // = 18:3o:oo                    $time = str_repeat($value,"o","0");                    $newData[url] = $time;                    break;                case "ID_ALT" : // =                    break;                case "EXTRA" : //  = Hallo,                    break;                case "aktiv" : // = ja "                    switch ($value) {                        case "ja" : $newData[show] = 1; break;                        case "nein" : $newData[show] = 0; break;                        default :                            echo "unkown aktiv Value $value <br>";                    }                    break;                default :                    echo (" -- $key = $value <br>");            }                    }        //echo ("<h3> Result in NewData </h3>");        //show_array($newData);        return $newData;    }    function klappe_convertTemine_new($data) {        $newData = array();        foreach ($data as $key => $value) {            switch ($key) {               case "id" :                    // $newData[id] = $value;                    break;               case "date" :                   $newData[date] = $value;                   break;               case "kat" :                   switch($value) {                        case 1 : $catName = "Theater/Kabarett/Show"; break;                        case 2 : $catName = "Musik"; break;                        case 3 : $catName = "Lesung/Vortrag"; break;                        case 4 : $catName = "Sonstiges"; break;                        case 5 : $catName = "Kinder"; break;                        case 6 : $catName = "Party/Disco"; break;                        default:                            echo ("unkwon kat $value <br>");                            $catName = 0;                   }                   $category = cmsCategory_get(array("name"=>$catName,"mainCat"=>1));                   if (is_array($category)) {                        // echo ("Kategorie $category[name] , $category[id] <br>");                        $newData[category] = $category[id];                   } else {                       echo ("Termin Kategorie nicht gefunden <br>");                       return 0;                   }                   break;                case "city" :                    switch ($value) {                        case 1 : $regionName = "Karlsruhe"; break;                        case 2 : $regionName = "Gaggenau"; break;                        case 3 : $regionName = "Baden-Baden"; break;                        case 4 : $regionName = "Pforzheim"; break;                        case 5 : $regionName = "Bruchsal"; break;                        case 6 : $regionName = "Ettlingen"; break;                        case 7 : $regionName = "Umland Karlsruhe"; break;                        case 8 : $regionName = "Bretten"; break;                        case 9 : $regionName = "Rastatt"; break;                        case 10 : $regionName = "Rhein/Neckar"; break;                        case 11 : $regionName = "Pfalz"; break;                        case 12 : $regionName = "Region"; break;                        case 13 : $regionName = "Elsass"; break;                        default:                            echo ("unkwon Region $value <br>");                            $regionName = 0;                    }                    $region = cmsCategory_get(array("name"=>$regionName,"mainCat"=>180));                    if (is_array($region)) {                        // echo ("found Region $region[name], $region[id] <br>");                        $newData[region] = $region[id];                   } else {                       echo ("Region Kategorie nicht $regionName gefunden <br>");                       return 0;                   }                   break;                case "location" :                    $dataGet = $this->__init();                    $url = $dataGet[serverPath].$dataGet[phpGetFile];                    $url .= "?mode=getData";                    $url .= "&show=tableData&tableName=klappe_date_location";                    $url .= "&filter=id*".$value;                    $locData = $this->get_url($url);                    if (is_array($locData)) {                        if (count ($locData)==1) {                            $locationName = $locData[0]["name"];                            // echo (" LOCATION $locationName <br>");                            $locationData = cmsLocation_get(array("name"=>$locationName));                            if (is_array($locationData)) {                                $locationId = $locationData[id];                                // echo ("Fond Location in Database $locationId <br>");                                $newData[location] = $locationId;                            } else {                                echo ("</h1>LOCATION FROM cmsDataBase not found $locationName </h1>");                                $newData[locationStr] = $locationName;                                                          }                        } else {                            for ($i=0;$i<count($locData);$i++) {                                echo ("FOUND $i ".$locData[$i][name]." - ".$locData[$i][adress]."<br>");                            }                            return 0;                        }                                            }                    //echo ("$url <br>$data<br>");                case "headline" : //  = Nur wer für die Juden schreit, darf gregorianisch singen                    $newData[name] = $value;                    break;                case "text" : // = 20.-22.2. Tagung zum 100. Geburtstag Dietrich Bonhoeffers                    $newData[info] = $value;                    break;                case "time" :                    if (strlen($value)==5) $value .= ":00";                    $newData[time] = $value;                    break;                                default :                    echo (" -- $key = $value <br>");            }        }        $newData[show] = 1;        // echo ("<h3> Result in NewData </h3>");        // show_array($newData);        return $newData;    }    function klappe_convertLocation($data) {        // echo ("HIER !!! <br>");        $newData = array();        foreach ($data as $key => $value) {            switch ($key) {                 case "id" :                    $newData[id] = $value;                    break;                case "stand" : // = 20.02.2006                    $newData[lastMod] = $value;                    break;                case "index_location" :                    while (strlen($value)<3) $value = "0".$value;                    $category = cmsCategory_get(array("info"=>$value,"mainCat"=>8));                    if (is_array($category)) {                        // show_array($category);                        $newData[category] = $category[id];                    } else {                        echo ("Kategorie nicht gefunde $category <br>");                        show_array($data);                        $newData[category] = 0;                                            }                    break;                                case "name" :                    // $value = iconv('ISO-8859-1', 'ISO-8859-15', $value);                    $newData[name] = $value;                    // echo("Name: $value <br>");                    break; // = A&S Bücherland                case "bildname" :                    if ($value) {                        if (!is_array($newData[data])) $newData[data] = array();                        $newData[data][imageFile] = php_clearStr($value);                        // echo ("SetImageFile to '$value' <br>");                    }                    break;                case "website" : $newData[url] = $value; break;// = http://www.buecherland.de/                case "email" : $newData[email] = $value; break;//                case "strasse" : $newData[street] = $value; break;// = Rintheimer Str                case "hnr" : $newData[streetNr] = $value; break;// = 19                case "plz" : $newData[plz] = $value; break;// = 76131                case "ort" : $newData[city] = $value; break;// = Karlsruhe - Oststadt                case "stadtteil" :                    if ($value) {                        echo ("Unkown Element $key = '$value' <br>");                        return 0;                    }                    break;                case "vorwahl" :                    if (strlen($value)>0 AND $value[0] != "0") $value = "0".$value;                    $newData[phoneRegion] = $value;                    break;// = 0162                case "tel" : $newData[phonePhone] = $value; break;// = 584 34 34                              case "fax" : $newData[phoneFax] = $value; break;// =                case "oeffnungszeiten" ://=                    if ($value) {                        if (!is_array($newData[data])) $newData[data] = array();                        $newData[data]["open"] = php_clearStr($value);                        // echo "Öffnungszeiten = $value <br>";                    }                    break;                case "bemerkung" :// = Tickets über E-Mail bestellen                    if ($value) {                        if (!is_array($newData[data])) $newData[data] = array();                        $newData[data][notice] = php_clearStr($value);                    }                    break;                case "kueche" :                    if ($value) {                        if (!is_array($newData[data])) $newData[data] = array();                        $newData[data][kitchen] = php_clearStr($value);                    }                    break;// =                case "online-tickets" : $newData[ticketUrl] = $value;break; // = http://www.buecherland.de/veranstaltungen.htm                case "sonstiges" :                    if ($value) {                        if (!is_array($newData[data])) $newData[data] = array();                        $newData[data][more] = php_clearStr($value);                        // echo ("sonstiges $value <br>");                    }                    break;//                                                   case "aktiv" : // = ja "                    switch ($value) {                        case "ja" : $newData[show] = 1; break;                        case "nein" : $newData[show] = "0"; break;                        default :                            echo "unkown aktiv Value $value <br>";                    }                    break;                default :                    echo (" -- '$key' = $value <br>");            }        }    //         $newData[mainCat] = 8;        // $newData[id] = null;        //echo ("<h3> Result in NewData </h3>");        //show_array($newData[data]);        return $newData;    }    function klappe_convertLocationIndex($data) {        $newData = array();        foreach ($data as $key => $value) {            switch ($key) {                case "id" :                    $newData[id] = $value;                    break;                case "aktiv" : // = ja "                    switch ($value) {                        case "ja" : $newData[show] = 1; break;                        case "nein" : $newData[show] = 0; break;                        default :                            echo "unkown aktiv Value $value <br>";                    }                    break;               case "description" : //  = Undefiniert                   $newData[name] = $value;                   break;               case "art" : // art = 000                   $newData[info] = $value;                   break;                default :                    echo (" -- $key = $value <br>");            }        }        $newData[mainCat] = 8;        $newData[id] = null;        // echo ("<h3> Result in NewData </h3>");        return $newData;     }    function saveData_own($tableName,$data) {        // echo ("SaveData_own $tableName,$data <br>");        switch ($tableName) {            case "klappe_alt_location_index" :                $res = cmsCategory_save($data);                // echo ("Result of Save Category = $res<br>");                return $res;            case "location.txt" :                $res = cmsLocation_save($data);                return $res;            case "klappe_alt_locations" :                $res = cmsLocation_save($data);                return $res;            case "locations" :                $res = cmsLocation_save($data);                // $res = 1;                return $res;            case "klappe_alt_termine" :                $res = cmsLocation_save($data);                //$res = 1;                return $res;           case "klappe_date_dates" :               $res = cmsDates_save($data);               return $res;               break;           case "inhalte" :               $res = cmsArticles_save($data);               return $res;        }        return "not Set for tableName ".$tableName;    } }?>