<?php // charset:UTF-8class  cmsAdmin_location extends cmsAdmin_location_base {        function checkList($dataList,$action) {        //        $fn = "cms_admin_location_own_action.php";//        if (file_exists("cms/admin/".$fn)) {//            echo ("exist in cms/admin/".$fn."<br>");//            include ("cms/admin/".$fn);//            checkList_own($dataList,$action);//        }//        if (file_exists($GLOBALS[cmsName]."/cms/admin/".$fn)) {//            echo ("exist in ".$GLOBALS[cmsName]."/cms/admin/".$fn."<br>");//        }        // echo ("<h1>CheckList $dataList</h1>");        // $action = "removeTicket";                switch ($action) {            case "checkUrl" :                                for ($i=0;$i<count($dataList);$i++) {                    $location = $dataList[$i];                    $id = $location[id];                    $name = $location[name];                    $url = $location[url];                    if ($url) {                        // echo ("check url from $id $name '$url' <br>");                        $remove = 0;                        if ($url == "x-url-x") $remove = 1;                        if ($url == "http://") $remove = 1;                        if ($url == "http://www.") $remove = 1;                        if ($remove) {                             echo (" -> <b>remove '$url' </b><br>");                             $query = "UPDATE `klappeAuf_cms_location` SET `url` = '' WHERE `id`=$id";                             $result = mysql_query($query);                             if (!$result) echo ("$query <br>");                        } else {                            if (substr($url,0,7) == "http://" ) {                                $url = substr($url,7);                                echo (" -> <b>remove http:// '$url' </b><br>");                                $query = "UPDATE `klappeAuf_cms_location` SET `url` = '$url' WHERE `id`=$id";                                $result = mysql_query($query);                                if (!$result) echo ("$query <br>");                            }                                                    }                    }                }                break;                                    case "removeTicket" :                                for ($i=0;$i<count($dataList);$i++) {                    $location = $dataList[$i];                    $id = $location[id];                    $name = $location[name];                    $ticketUrl = $location[ticketUrl];                    if ($ticketUrl) {                        echo ("remove ticketUrl from $id $name $ticketUrl <br>");                        $query = "UPDATE `klappeAuf_cms_location` SET `ticketUrl` = '' WHERE `id`=$id";                        $result = mysql_query($query);                        if (!$result) echo ("$query <br>");                    }                }                break;                        case "emptyEnd" :                                 echo ("Check $dataList <br>");                for ($i=0;$i<count($dataList);$i++) {                    $location = $dataList[$i];                    $id = $location[id];                    $name = $location[name];                    $newName = $name;                    // Leerzeichen am Anfang weg                    while ($newName[0] == " ") $newName = substr($newName,1);                                        // Leerteichen am ende weg                    while ($newName[strlen($newName)-1] == " ") $newName = substr ($newName,0,strlen($newName)-1);//                    if ($newName[strlen($newName)-1] == " ") {//                        echo (" Letztes = '".$newName[strlen($newName)-1]."'");//                        $newName = substr ($newName,0,strlen($newName)-1);//                    }//                                        if ($newName != $name) {                         echo ("$i $id '$newName' <br>");                         $query = "UPDATE `klappeAuf_cms_location` SET `name` = '$newName' WHERE `id`=$id";                         $result = mysql_query($query);                         if (!$result) echo ("$query <br>");                    }                    // while ($newName[strlen($newName)-1] == " ") $newName = substr ($newName,0,strlen($newName))                                                                                               }                break;            default :                                //show_array($dataList);        }    }            function emptyListSelect_own() {        $ownSelect = array();        //$ownSelect["dateRange"] = "week";        // $ownSelect["specialView"] = "hidden";        // $ownSelect["region"] = 181;        // $ownSelect["category"] = 3;        //$ownSelect["location"] = "kap";        return $ownSelect;    }        function emptyListFilter_own() {        return array();    }              function checkData($data) {        // echo ("<h1>Check Data</h1>");        // Check StraÃŸe HausNummer        $change = 0;        $street = trim($data[street]);        $streetNr = trim($data[streetNr]);        // echo ("Vorher => '$street' '$streetNr' <br>");        if ($streetNr) {            $offSet = strpos($street,$streetNr);            if ($offSet) {                $street = substr($street,0,$offSet);                $street = trim($street);                $change = 1;            }        } else {            $numStr = str_replace(array("0","1","2","3","4","5","6","7","8","9"),"#",$street);            // echo ("NumStr = '$numStr<br>");            $offSet = strpos($numStr,"#");            if ($offSet) {                $streetNr = substr($street,$offSet);                $street = substr($street,0,$offSet);                $street = trim($street);                $streetNr = trim($streetNr);                $change = 1;            }        }        if ($change) {            //echo ("Danach => '$street' '$streetNr' <br>");            $data[street] = $street;            $data[streetNr] = $streetNr;        }        // End of Street / StreetNr ////////////////////////////////////////////        // Check plz city //////////////////////////////////////////////////////        $change = 0;        $city = trim($data[city]);        $plz = trim($data[plz]);        // echo ("Vorher => '$plz' '$city' <br>");        if ($plz) {            $isPlzStr = substr($city,0,5);            if (intval($plz) AND intval($isPlzStr)) {                if ($plz == $isPlzStr) {                    echo "PLZ is same '$plz' = '$isPlzStr' <br>";                    $city = substr($city,5);                    $city = trim($city);                    $change = 1;                      }            }        } else {            $isPlzStr = substr($city,0,5);            if (intval($isPlzStr)) {                $plz = $isPlzStr;                $city = substr($city,5);                $city = trim($city);                $change = 1;                            }             }        $smallCity = strtolower($city);        $offKa = strpos($city,"ka");        if (!is_null($offKa)) {            $kaPlus = strtolower(substr($city,$offKa,3));            // echo ("KAPLUS = '$kaPlus' <br>");            if ($kaPlus == "ka" OR $kaPlus == "ka-" OR $kaPlus == "ka ") {                $city = "Karlsruhe".substr($city,$offKa+2);                $change = 1;                            }        }                if ($change) {            // echo ("Danach => '$plz' '$city' <br>");            $data[city] = $city;            $data[plz] = $plz;        }        // End of City / PLZ ///////////////////////////////////////////////////                // PHONE / FAX  ////////////////////////////////////////////////////////        $change = 0;        $phoneRegion = trim($data[phoneRegion]);        $phonePhone  = trim($data[phonePhone]);        $phoneFax    = trim($data[phoneFax]);        // echo ("Vorher => '$phoneRegion' '$phonePhone' '$phoneFax' <br>");        if ($phoneRegion) {            $isPhoneRegionStr = substr($phonePhone,0,strlen($phoneRegion));            if ($isPhoneRegionStr == $phoneRegion) { // Vorwahl gleich                // echo ("Vorwahl ist gleich $phoneRegion $isPhoneRegionStr <br>");                $phonePhone = substr($phonePhone,strlen($phoneRegion));                $phonePhone = trim($phonePhone);                $change = 1;                // echo ("NewPhonePhone = '$phonePhone'<br>");            }            $isFaxRegionStr = substr($phoneFax,0,strlen($phoneRegion));            if ($isFaxRegionStr == $phoneRegion) { // Vorwahl gleich                // echo ("Vorwahl ist gleich $phoneRegion $isPhoneRegionStr <br>");                $phoneFax = substr($phoneFax,strlen($phoneRegion));                $phoneFax = trim($phoneFax);                $change = 1;                // echo ("NewPhoneFax = '$phoneFax'<br>");            }                 } else {            $numPhone = str_replace(array("("),"",$phonePhone);            $numPhone = str_replace(array(" ","/","-",")"),"#",$numPhone);            $numPhone = str_replace("##","#",$numPhone);            $numPhone = str_replace("##","#",$numPhone);            $numPhone = str_replace("##","#",$numPhone);            // echo ("NumStr = '$numPhone<br>");            $splitList = explode("#",$numPhone);            if (count($splitList)>2) {                $phoneRegion = $splitList[0];                $phonePhone = "";                echo ("<h3>");                for ($s=1;$s<count($splitList);$s++) {                    echo ("$splitList[$s]-");                    if ($phonePhone!="") $phonePhone .= "-";                    $phonePhone .= $splitList[$s];                }                                echo("</h3>");                $change = 1;            }            if (count($splitList) == 2) {                $phoneRegion = $splitList[0];                $phonePhone = $splitList[1];                // echo ("Danach => '$phoneRegion' '$phonePhone' '$phoneFax' <br>");                $change = 1;            }        }        $shortPhonePhone = str_replace(array(" ","/","."),"",$phonePhone);        if ($shortPhonePhone != $phonePhone) {$phonePhone = $shortPhonePhone;$change=1;}        $shortPhoneFax = str_replace(array(" ","/","."),"",$phoneFax);        if ($shortPhoneFax != $phoneFax) {$phoneFax = $shortPhoneFax;$change=1;}        if ($change) {            //$phonePhone = str_replace(array(" ","/","-","."),"",$phonePhone);            // $phoneFax   = str_replace(array(" ","/","-","."),"",$phoneFax);            // echo ("Danach => '$phoneRegion' '$phonePhone' '$phoneFax' <br>");            $data[phoneRegion] = $phoneRegion;            $data[phonePhone] = $phonePhone;            $data[phoneFax] = $phoneFax;//            $data[streetNr] = $streetNr;        }        // End of Phone / Fax //////////////////////////////////////////////////        return $data;    }        function admin_get_specialFilterList_own() {        $specialList = array();                $specialList[hidden] = array("id"=>"hidden","name"=>"Unsichtbare Orte");        $specialList[hidden][filter] = array("show"=>0);        $specialList[hidden][sort] = "name";        $specialList[noRegion] = array("id"=>"noRegion","name"=>"Orte ohne Region");        $specialList[noRegion][filter] = array("region"=>"0","show"=>"-");        $specialList[noRegion][sort] = "name";        $specialList[noCategory] = array("id"=>"noCategory","name"=>"Orte ohne Kategorie");        $specialList[noCategory][filter] = array("category"=>"0","show"=>"-");        $specialList[noCategory][sort] = "name";        $specialList[noWeb] = array("id"=>"noWeb","name"=>"Orte ohne Internetadresse");        $specialList[noWeb][filter] = array("url"=>"","show"=>"-");        $specialList[noWeb][sort] = "name";        return $specialList;    }    function admin_get_filterList_own() {        $filterList = array();        $filterList[specialView]   = array();        $filterList[specialView]["name"] = "Spezielle Ansichten";        $filterList[specialView]["type"] = "specialView";        $filterList[specialView]["showData"] = array("submit"=>1,"empty"=>"normale Ansicht");        //$filterList[specialView]["filter"] = array("mainCat"=>180,"show"=>1);        // $filterList[specialView]["sort"] = "name";        $filterList[specialView]["dataName"] = "specialView";        $filterList[specialView][customFilter] = 1;        $filterList[produkt] = 0;        $filterList[category] = array();        $filterList[category]["name"] = "Kategorie";        $filterList[category]["type"] = "category";        $filterList[category]["dataName"] = "category";        $filterList[category]["showData"] = array("submit"=>1,"empty"=>"Kategorie wÃ¤hlen");        $filterList[category]["filter"] = array("mainCat"=>8,"show"=>1);        $filterList[category]["sort"] = "name";        $filterList[category][customFilter] = 1;        $filterList[region]   = array();        $filterList[region]["name"] = "Region";        $filterList[region]["type"] = "category";        $filterList[region]["showData"] = array("submit"=>1,"empty"=>"Region wÃ¤hlen");        $filterList[region]["filter"] = array("mainCat"=>180,"show"=>1);        $filterList[region]["sort"] = "name";        $filterList[region]["dataName"] = "region";        $filterList[region][customFilter] = 1;        $filterList[location] = array();        $filterList[location]["name"] = "Ort";        $filterList[location]["type"] = "location";        $filterList[location]["dataName"] = "location";        $filterList[location]["showData"] = array("submit"=>1,"type"=>"simple","empty"=>"Ort wÃ¤hlen");        $filterList[location]["filter"] = array("show"=>"1");        $filterList[location]["sort"] = "name";        $filterList[location][customFilter] = 1;               return $filterList;    }     function edit_show_own($tableName,$specialData) {              // show_array($specialData);        $editShow = array();        $editShow[id]      = array("name"=>"Ort Id","show"=>1,"showLevel"=>9,"type"=>"text","width"=>"small","readonly"=>1);        $editShow[id][needed] = 0;        $editShow[name]    = array("name"=>"Name","show"=>1,"type"=>"text","width"=>"standard");        $editShow[name][needed] = "textContent";        $editShow[name][needError] = "Kein Artikelname eingeben";        $editShow[subName]    = array("name"=>"Name","show"=>0,"type"=>"text","width"=>"standard");                $editShow[info]    = array("name"=>"Info","show"=>1,"type"=>"textarea","width"=>"standard","height"=>"standard");        $editShow[info][needed] = 0;        // Category        $editShow[category] = array("name"=>"Kategorie","show"=>1,"type"=>"toggle","width"=>"standard");        $editShow[category][showData] = array("class"=>"adminArticles_Category","count"=>3,"mode"=>"multi");        $editShow[category][showFilter] = array("mainCat"=>8,"show"=>1);        $editShow[category][showSort] = "name";        $editShow[category][needed] = 1;        $editShow[category][needError] = "Keine Kategorie ausgewÃ¤hlt";         // Region        $editShow[region] = array("name"=>"Region","show"=>1,"type"=>"toggle","width"=>"standard");        $editShow[region][showData] = array("class"=>"adminArticles_Region","count"=>3,"mode"=>"single");        $editShow[region][showFilter] = array("mainCat"=>180,"show"=>1);        $editShow[region][showSort] = "name";        $editShow[region][needed] = 1;        $editShow[region][needError] = "Keine Region ausgewÃ¤hlt";        $editShow[contactName]    = array("name"=>"Ansprech-Partner","show"=>0,"type"=>"text","width"=>"standard");        $editShow[contactName][needed] = 0;        $editShow[street]      = array("name"=>"StraÃŸe" ,"show"=>1,"type"=>"text","width"=>"78%");        $editShow[street][needed] = 0;        $editShow[street][next] = "streetNr";        $editShow[streetNr]      = array("name"=>"Hausnummer" ,"show"=>1,"type"=>"text","width"=>"20%");        $editShow[streetNr][needed] = 0;        $editShow[plz]      = array("name"=>"Plz","show"=>1,"type"=>"text","width"=>"20%");        $editShow[plz][needed] = 0;        $editShow[plz][next] = "city";        $editShow[city]      = array("name"=>"Ort","show"=>1,"type"=>"text","width"=>"78%");        $editShow[city][needed] = 1;        $editShow[email]      = array("name"=>"eMail","show"=>1,"type"=>"text","width"=>"standard");        $editShow[email][needed] = 0;        $editShow[phoneRegion]      = array("name"=>"Vorwahl","show"=>1,"type"=>"text","width"=>"15%");        $editShow[phoneRegion][next] = "phonePhone";        $editShow[phoneRegion][needed] = 0;        $editShow[phonePhone]      = array("name"=>"Telefon","show"=>1,"type"=>"text","width"=>"25%");        $editShow[phonePhone][needed] = 0;        $editShow[phoneFax]      = array("name"=>"Fax","show"=>0,"type"=>"text","width"=>"small");        $editShow[phoneFax][needed] = 0;        $editShow[phoneMobil]      = array("name"=>"Mobil","show"=>0,"type"=>"text","width"=>"small");        $editShow[phoneMobil][needed] = 0;        $editShow[image] = array("name"=>"Ort-Bild","show"=>1,"type"=>"imageSelectList","width"=>"standard","imgWidth"=>100,"imgHeight"=>75,"lineCount"=>3);        $editShow[image][needed] = 0;        $editShow[image][imageUpload] = 1;        $editShow[image][imageFolder] = "/locations/";        $editShow[url]    = array("name"=>"Webseite","show"=>1,"type"=>"text","width"=>"standard");        $editShow[url][needed] = 0;        $editShow[ticketUrl]    = array("name"=>"Ticket Webseite","show"=>1,"type"=>"text","width"=>"standard");        $editShow[ticketUrl][needed] = 0;        $editShow[ticketUrl][show] = 0;                // $editShow[sort] = array("name"=>"Sortierung","show"=>1,"type"=>"text","width"=>"standard");        // $editShow[sort][needed] = 0;        $editShow[data] = array("name"=>"Data","show"=>1,"type"=>"data","width"=>"standard");        $editShow[data][showData] = array();        $editShow[data][showData][open] = array("name"=>"Ã–ffnungszeiten","show"=>1,"type"=>"textarea","height"=>50,"openClose"=>1);        $editShow[data][showData][notice] = array("name"=>"Bemerkung","show"=>1,"type"=>"textarea","openClose"=>1);        $editShow[data][showData][kitchen] = array("name"=>"KÃ¼che","show"=>1,"type"=>"textarea","openClose"=>1);        $editShow[data][showData][info_20] = array("name"=>"Biergarten-Text","show"=>1,"type"=>"textarea","openClose"=>1);        $editShow[data][showData][info_19] = array("name"=>"CafÃ©-Text","show"=>1,"type"=>"textarea","openClose"=>1);        $editShow[data][showData][info_18] = array("name"=>"Kneipen-Text","show"=>1,"type"=>"textarea","openClose"=>1);        $editShow[data][showData][info_22] = array("name"=>"Restaurant-Text","show"=>1,"type"=>"textarea","openClose"=>1);        $editShow[show] = array("name"=>"Anzeigen","show"=>1,"type"=>"checkbox","width"=>"standard");        $editShow[show][needed] = 0;        return $editShow;    }        function cacheRefresh($id,$saveData,$mode) {        // box-322        // box-321        // box-320                        cmsCache_deleteId("adressen.php", $id, array("gastro-320","gastro-321","gastro-322"));                        // echo ("<h1>cacheRefresh($id,$mode)</h1>");        $filter = array("location"=>$id);                $dateList = cmsDates_getList($filter);        for ($i=0;$i<count($dateList);$i++) {            $dateId = $dateList[$i][id];            $dateName = $dateList[$i][name];            // echo ("Change in Location $id - Date with id = $dateId $dateName <br>");                        cmsCache_deleteId("kalender.php", $dateId, array("short"));        }                }                function editButtons_own($buttonList,$saveData) {        // $buttonList = array();        if ($saveData[id]) {            $buttonList[save][name] = "Ort speichern";        } else {            $buttonList[save][name] = "Ort anlegen";        }                // Zeige Datensatz        if ($saveData[id]>0) {            $addData = array();            $addData[type] = "link";            $addData["class"] = 'cmsLinkButton cmsSecond';            $addData[link] = "adressen.php?location=$saveData[id]";            $addData[name] = "Ort Zeigen";            $buttonList[show] = $addData;        }        return $buttonList;    }    }?>