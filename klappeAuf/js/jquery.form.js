(function(b){function s(){b.fn.ajaxSubmit.debug&&window.console&&window.console.log&&window.console.log("[jquery.form] "+Array.prototype.join.call(arguments,""))}b.fn.ajaxSubmit=function(a){function e(){function m(){if(!z++){n.detachEvent?n.detachEvent("onload",m):n.removeEventListener("load",m,false);var r=0,l=true;try{if(A)throw"timeout";var t,o;o=n.contentWindow?n.contentWindow.document:n.contentDocument?n.contentDocument:n.document;if(o.body==null&&!r&&b.browser.opera){r=1;z--;setTimeout(m,100); return}j.responseText=o.body?o.body.innerHTML:null;j.responseXML=o.XMLDocument?o.XMLDocument:o;j.getResponseHeader=function(D){return{"content-type":i.dataType}[D]};if(i.dataType=="json"||i.dataType=="script"){var B=o.getElementsByTagName("textarea")[0];j.responseText=B?B.value:j.responseText}else if(i.dataType=="xml"&&!j.responseXML&&j.responseText!=null)j.responseXML=x(j.responseText);t=b.httpData(j,i.dataType)}catch(E){l=false;b.handleError(i,j,"error",E)}if(l){i.success(t,"success");u&&b.event.trigger("ajaxSuccess", [j,i])}u&&b.event.trigger("ajaxComplete",[j,i]);u&&!--b.active&&b.event.trigger("ajaxStop");if(i.complete)i.complete(j,l?"success":"error");setTimeout(function(){v.remove();j.responseXML=null},100)}}function x(r,l){if(window.ActiveXObject){l=new ActiveXObject("Microsoft.XMLDOM");l.async="false";l.loadXML(r)}else l=(new DOMParser).parseFromString(r,"text/xml");return l&&l.documentElement&&l.documentElement.tagName!="parsererror"?l:null}var p=g[0];if(b(":input[name=submit]",p).length)alert('Error: Form elements must not be named "submit".'); else{var i=b.extend({},b.ajaxSettings,a),q=jQuery.extend(true,{},b.extend(true,{},b.ajaxSettings),i),y="jqFormIO"+(new Date).getTime(),v=b('<iframe id="'+y+'" name="'+y+'" />'),n=v[0];if(b.browser.msie||b.browser.opera)n.src='javascript:false;document.write("");';v.css({position:"absolute",top:"-1000px",left:"-1000px"});var j={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){this.aborted= 1;v.attr("src","about:blank")}},u=i.global;u&&!b.active++&&b.event.trigger("ajaxStart");u&&b.event.trigger("ajaxSend",[j,i]);if(q.beforeSend&&q.beforeSend(j,q)===false)q.global&&jQuery.active--;else if(!j.aborted){var z=0,A=0;if(q=p.clk){var C=q.name;if(C&&!q.disabled){a.extraData=a.extraData||{};a.extraData[C]=q.value;if(q.type=="image"){a.extraData[name+".x"]=p.clk_x;a.extraData[name+".y"]=p.clk_y}}}setTimeout(function(){var r=g.attr("target"),l=g.attr("action");g.attr({target:y,method:"POST",action:i.url}); a.skipEncodingOverride||g.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});i.timeout&&setTimeout(function(){A=true;m()},i.timeout);var t=[];try{if(a.extraData)for(var o in a.extraData)t.push(b('<input type="hidden" name="'+o+'" value="'+a.extraData[o]+'" />').appendTo(p)[0]);v.appendTo("body");n.attachEvent?n.attachEvent("onload",m):n.addEventListener("load",m,false);p.submit()}finally{g.attr("action",l);r?g.attr("target",r):g.removeAttr("target");b(t).remove()}},10)}}}if(!this.length){s("ajaxSubmit: skipping submit process - no element selected"); return this}if(typeof a=="function")a={success:a};a=b.extend({url:this.attr("action")||window.location.toString(),type:this.attr("method")||"GET"},a||{});var c={};this.trigger("form-pre-serialize",[this,a,c]);if(c.veto){s("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this}if(a.beforeSerialize&&a.beforeSerialize(this,a)===false){s("ajaxSubmit: submit aborted via beforeSerialize callback");return this}var d=this.formToArray(a.semantic);if(a.data){a.extraData=a.data;for(var f in a.data)if(a.data[f]instanceof Array)for(var k in a.data[f])d.push({name:f,value:a.data[f][k]});else d.push({name:f,value:a.data[f]})}if(a.beforeSubmit&&a.beforeSubmit(d,this,a)===false){s("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[d,this,a,c]);if(c.veto){s("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this}c=b.param(d);if(a.type.toUpperCase()=="GET"){a.url+=(a.url.indexOf("?")>=0?"&":"?")+c;a.data=null}else a.data=c;var g=this,h=[];a.resetForm&& h.push(function(){g.resetForm()});a.clearForm&&h.push(function(){g.clearForm()});if(!a.dataType&&a.target){var w=a.success||function(){};h.push(function(m){b(a.target).html(m).each(w,arguments)})}else a.success&&h.push(a.success);a.success=function(m,x){for(var p=0,i=h.length;p<i;p++)h[p].apply(a,[m,x,g])};c=b("input:file",this).fieldValue();d=false;for(f=0;f<c.length;f++)if(c[f])d=true;if(a.iframe||d)b.browser.safari&&a.closeKeepAlive?b.get(a.closeKeepAlive,e):e();else b.ajax(a);this.trigger("form-submit-notify", [this,a]);return this};b.fn.ajaxForm=function(a){return this.ajaxFormUnbind().bind("submit.form-plugin",function(){b(this).ajaxSubmit(a);return false}).each(function(){b(":submit,input:image",this).bind("click.form-plugin",function(e){var c=this.form;c.clk=this;if(this.type=="image")if(e.offsetX!=undefined){c.clk_x=e.offsetX;c.clk_y=e.offsetY}else if(typeof b.fn.offset=="function"){var d=b(this).offset();c.clk_x=e.pageX-d.left;c.clk_y=e.pageY-d.top}else{c.clk_x=e.pageX-this.offsetLeft;c.clk_y=e.pageY- this.offsetTop}setTimeout(function(){c.clk=c.clk_x=c.clk_y=null},10)})})};b.fn.ajaxFormUnbind=function(){this.unbind("submit.form-plugin");return this.each(function(){b(":submit,input:image",this).unbind("click.form-plugin")})};b.fn.formToArray=function(a){var e=[];if(this.length==0)return e;var c=this[0],d=a?c.getElementsByTagName("*"):c.elements;if(!d)return e;for(var f=0,k=d.length;f<k;f++){var g=d[f],h=g.name;if(h)if(a&&c.clk&&g.type=="image")!g.disabled&&c.clk==g&&e.push({name:h+".x",value:c.clk_x}, {name:h+".y",value:c.clk_y});else if((g=b.fieldValue(g,true))&&g.constructor==Array)for(var w=0,m=g.length;w<m;w++)e.push({name:h,value:g[w]});else g!==null&&typeof g!="undefined"&&e.push({name:h,value:g})}if(!a&&c.clk){a=c.getElementsByTagName("input");f=0;for(k=a.length;f<k;f++){d=a[f];(h=d.name)&&!d.disabled&&d.type=="image"&&c.clk==d&&e.push({name:h+".x",value:c.clk_x},{name:h+".y",value:c.clk_y})}}return e};b.fn.formSerialize=function(a){return b.param(this.formToArray(a))};b.fn.fieldSerialize= function(a){var e=[];this.each(function(){var c=this.name;if(c){var d=b.fieldValue(this,a);if(d&&d.constructor==Array)for(var f=0,k=d.length;f<k;f++)e.push({name:c,value:d[f]});else d!==null&&typeof d!="undefined"&&e.push({name:this.name,value:d})}});return b.param(e)};b.fn.fieldValue=function(a){for(var e=[],c=0,d=this.length;c<d;c++){var f=b.fieldValue(this[c],a);f===null||typeof f=="undefined"||f.constructor==Array&&!f.length||(f.constructor==Array?b.merge(e,f):e.push(f))}return e};b.fieldValue= function(a,e){var c=a.name,d=a.type,f=a.tagName.toLowerCase();if(typeof e=="undefined")e=true;if(e&&(!c||a.disabled||d=="reset"||d=="button"||(d=="checkbox"||d=="radio")&&!a.checked||(d=="submit"||d=="image")&&a.form&&a.form.clk!=a||f=="select"&&a.selectedIndex==-1))return null;if(f=="select"){var k=a.selectedIndex;if(k<0)return null;c=[];f=a.options;var g=(d=d=="select-one")?k+1:f.length;for(k=d?k:0;k<g;k++){var h=f[k];if(h.selected){h=b.browser.msie&&!h.attributes.value.specified?h.text:h.value; if(d)return h;c.push(h)}}return c}return a.value};b.fn.clearForm=function(){return this.each(function(){b("input,select,textarea",this).clearFields()})};b.fn.clearFields=b.fn.clearInputs=function(){return this.each(function(){var a=this.type,e=this.tagName.toLowerCase();if(a=="text"||a=="password"||e=="textarea")this.value="";else if(a=="checkbox"||a=="radio")this.checked=false;else if(e=="select")this.selectedIndex=-1})};b.fn.resetForm=function(){return this.each(function(){if(typeof this.reset== "function"||typeof this.reset=="object"&&!this.reset.nodeType)this.reset()})};b.fn.enable=function(a){if(a==undefined)a=true;return this.each(function(){this.disabled=!a})};b.fn.selected=function(a){if(a==undefined)a=true;return this.each(function(){var e=this.type;if(e=="checkbox"||e=="radio")this.checked=a;else if(this.tagName.toLowerCase()=="option"){e=b(this).parent("select");a&&e[0]&&e[0].type=="select-one"&&e.find("option").selected(false);this.selected=a}})}})(jQuery);